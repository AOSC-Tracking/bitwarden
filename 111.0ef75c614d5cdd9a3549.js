"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[111],{25111:(t,e,i)=>{i.d(e,{Y:()=>M});var n,o=i(99042),r=i(24852),s=i(98645),c=i(54019),l=i(68362),a=i(62324),p=i(53634),u=i(20099),d=i(87264);!function(t){t[t.AccountEncrypted=0]="AccountEncrypted",t[t.FileEncrypted=1]="FileEncrypted"}(n||(n={}));var f=i(85958),h=i(81542),y=i(76528),g=i(78627),m=i(99721),x=i(87483),v=i(83924),w=i(66459),_=i(42304),U=i(53481),Z=i(73369),E=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(e){r(e)}}function c(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}l((n=n.apply(t,e||[])).next())}))};class b{get disabledByPolicy(){return this._disabledByPolicy}constructor(t,e,i,o,l,a,p,u,d,f,h,y){this.cryptoService=t,this.i18nService=e,this.platformUtilsService=i,this.exportService=o,this.eventCollectionService=l,this.policyService=a,this.win=p,this.logService=u,this.userVerificationService=d,this.formBuilder=f,this.fileDownloadService=h,this.dialogService=y,this.onSaved=new r.vpe,this.filePasswordValue=null,this._disabledByPolicy=!1,this.exportForm=this.formBuilder.group({format:["json"],secret:[""],filePassword:["",s.kI.required],confirmFilePassword:["",s.kI.required],fileEncryptionType:[n.AccountEncrypted]}),this.formatOptions=[{name:".json",value:"json"},{name:".csv",value:"csv"},{name:".json (Encrypted)",value:"encrypted_json"}],this.destroy$=new c.x}ngOnInit(){return E(this,void 0,void 0,(function*(){this.policyService.policyAppliesToActiveUser$(u.Mi.DisablePersonalVaultExport).pipe((0,l.R)(this.destroy$)).subscribe((t=>{this._disabledByPolicy=t,this.disabledByPolicy&&this.exportForm.disable()})),(0,a.T)(this.exportForm.get("format").valueChanges,this.exportForm.get("fileEncryptionType").valueChanges).pipe((0,l.R)(this.destroy$)).pipe((0,p.O)(0)).subscribe((()=>this.adjustValidators()))}))}ngOnDestroy(){this.destroy$.next()}get encryptedFormat(){return"encrypted_json"===this.format}doExport(){return E(this,void 0,void 0,(function*(){try{this.formPromise=this.getExportData();const t=yield this.formPromise;this.downloadFile(t),this.saved(),yield this.collectEvent(),this.exportForm.get("secret").setValue(""),this.exportForm.clearValidators()}catch(t){this.logService.error(t)}}))}submit(){return E(this,void 0,void 0,(function*(){if(this.disabledByPolicy)return void this.platformUtilsService.showToast("error",null,this.i18nService.t("personalVaultExportPolicyInEffect"));if(!(yield this.warningDialog()))return;const t=this.exportForm.get("secret").value;try{yield this.userVerificationService.verifyUser(t)}catch(e){return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),e.message)}this.doExport()}))}warningDialog(){return E(this,void 0,void 0,(function*(){return this.encryptedFormat?yield this.dialogService.openSimpleDialog({title:{key:"confirmVaultExport"},content:this.i18nService.t("encExportKeyWarningDesc")+" "+this.i18nService.t("encExportAccountWarningDesc"),acceptButtonText:{key:"exportVault"},type:"warning"}):yield this.dialogService.openSimpleDialog({title:{key:"confirmVaultExport"},content:{key:"exportWarningDesc"},acceptButtonText:{key:"exportVault"},type:"warning"})}))}saved(){this.onSaved.emit()}getExportData(){return"encrypted_json"===this.format&&this.fileEncryptionType===n.FileEncrypted?this.exportService.getPasswordProtectedExport(this.filePassword):this.exportService.getExport(this.format,null)}getFileName(t){let e=this.format;return"encrypted_json"===this.format&&(t=null==t?"encrypted":"encrypted_"+t,e="json"),this.exportService.getFileName(t,e)}collectEvent(){return E(this,void 0,void 0,(function*(){yield this.eventCollectionService.collect(d.tw.User_ClientExportedVault)}))}get format(){return this.exportForm.get("format").value}get filePassword(){return this.exportForm.get("filePassword").value}get confirmFilePassword(){return this.exportForm.get("confirmFilePassword").value}get fileEncryptionType(){return this.exportForm.get("fileEncryptionType").value}adjustValidators(){this.exportForm.get("confirmFilePassword").reset(),this.exportForm.get("filePassword").reset(),this.encryptedFormat&&this.fileEncryptionType==n.FileEncrypted?(this.exportForm.controls.filePassword.enable(),this.exportForm.controls.confirmFilePassword.enable()):(this.exportForm.controls.filePassword.disable(),this.exportForm.controls.confirmFilePassword.disable())}downloadFile(t){const e=this.getFileName();this.fileDownloadService.download({fileName:e,blobData:t,blobOptions:{type:"text/plain"}})}}b.ɵfac=function(t){return new(t||b)(r.Y36(y.$),r.Y36(g.D),r.Y36(m.P),r.Y36(f.qX),r.Y36(x.j),r.Y36(v.d),r.Y36(Window),r.Y36(w.$),r.Y36(_.i),r.Y36(s.QS),r.Y36(U._),r.Y36(Z.x))},b.ɵdir=r.lG2({type:b,viewQuery:function(t,e){if(1&t&&r.Gf(h.Z,5),2&t){let t;r.iGM(t=r.CRH())&&(e.passwordStrengthComponent=t.first)}},outputs:{onSaved:"onSaved"}});var T=i(4519),A=i(19419),F=i(24610),P=i(25376),S=i(53707),q=i(90258),C=i(24637),I=i(11512),Y=i(54666),O=i(1e4),D=i(36179),k=i(44358),L=i(21656),N=i(82933),V=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(e){r(e)}}function c(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}l((n=n.apply(t,e||[])).next())}))};function j(t,e){1&t&&(r.TgZ(0,"app-callout",15),r.ALo(1,"i18n"),r._uU(2),r.ALo(3,"i18n"),r.qZA()),2&t&&(r.s9C("title",r.lcZ(1,2,"vaultExportDisabled")),r.xp6(2),r.hij("\n    ",r.lcZ(3,4,"personalVaultExportPolicyInEffect"),"\n  "))}function B(t,e){if(1&t&&r._UZ(0,"app-export-scope-callout",16),2&t){const t=r.oxw(2);r.Q6J("organizationId",t.organizationId)}}function J(t,e){if(1&t&&(r.TgZ(0,"option",17),r._uU(1),r.qZA()),2&t){const t=e.$implicit;r.Q6J("value",t.value),r.xp6(1),r.Oqu(t.name)}}function Q(t,e){if(1&t){const t=r.EpF();r.ynx(0),r._uU(1,"\n          "),r.TgZ(2,"div",28),r._uU(3,"\n            "),r.TgZ(4,"bit-form-field"),r._uU(5,"\n              "),r.TgZ(6,"bit-label"),r._uU(7),r.ALo(8,"i18n"),r.qZA(),r._uU(9,"\n              "),r._UZ(10,"input",29),r._uU(11,"\n              "),r.TgZ(12,"button",30),r.NdJ("toggledChange",(function(e){r.CHM(t);const i=r.oxw(3);return r.KtG(i.showFilePassword=e)})),r.qZA(),r._uU(13,"\n              "),r.TgZ(14,"bit-hint"),r._uU(15),r.ALo(16,"i18n"),r.qZA(),r._uU(17,"\n            "),r.qZA(),r._uU(18,"\n            "),r.TgZ(19,"app-password-strength",31),r._uU(20,"\n            "),r.qZA(),r._uU(21,"\n          "),r.qZA(),r._uU(22,"\n\n          "),r.TgZ(23,"bit-form-field"),r._uU(24,"\n            "),r.TgZ(25,"bit-label"),r._uU(26),r.ALo(27,"i18n"),r.qZA(),r._uU(28,"\n            "),r._UZ(29,"input",32),r._uU(30,"\n            "),r.TgZ(31,"button",30),r.NdJ("toggledChange",(function(e){r.CHM(t);const i=r.oxw(3);return r.KtG(i.showFilePassword=e)})),r.qZA(),r._uU(32,"\n          "),r.qZA(),r._uU(33,"\n        "),r.BQk()}if(2&t){const t=r.oxw(3);r.xp6(7),r.Oqu(r.lcZ(8,7,"filePassword")),r.xp6(5),r.Q6J("toggled",t.showFilePassword),r.xp6(3),r.Oqu(r.lcZ(16,9,"exportPasswordDescription")),r.xp6(4),r.Q6J("password",t.filePassword)("showText",!0),r.xp6(7),r.Oqu(r.lcZ(27,11,"confirmFilePassword")),r.xp6(5),r.Q6J("toggled",t.showFilePassword)}}function z(t,e){if(1&t&&(r.ynx(0),r._uU(1,"\n        "),r.TgZ(2,"div",18),r._uU(3,"\n          "),r.TgZ(4,"label",19),r._uU(5),r.ALo(6,"i18n"),r.qZA(),r._uU(7,"\n\n          "),r.TgZ(8,"div",20),r._uU(9,"\n            "),r.TgZ(10,"div"),r._uU(11,"\n              "),r._UZ(12,"input",21),r._uU(13,"\n            "),r.qZA(),r._uU(14,"\n            "),r.TgZ(15,"div"),r._uU(16,"\n              "),r.TgZ(17,"label",22),r._uU(18),r.ALo(19,"i18n"),r.qZA(),r._uU(20,"\n            "),r.qZA(),r._uU(21,"\n          "),r.qZA(),r._uU(22,"\n\n          "),r.TgZ(23,"div",23),r._uU(24),r.ALo(25,"i18n"),r.qZA(),r._uU(26,"\n\n          "),r.TgZ(27,"div",24),r._uU(28,"\n            "),r.TgZ(29,"div"),r._uU(30,"\n              "),r._UZ(31,"input",25),r._uU(32,"\n            "),r.qZA(),r._uU(33,"\n            "),r.TgZ(34,"div"),r._uU(35,"\n              "),r.TgZ(36,"label",26),r._uU(37),r.ALo(38,"i18n"),r.qZA(),r._uU(39,"\n            "),r.qZA(),r._uU(40,"\n          "),r.qZA(),r._uU(41,"\n\n          "),r.TgZ(42,"div",27),r._uU(43),r.ALo(44,"i18n"),r.qZA(),r._uU(45,"\n        "),r.qZA(),r._uU(46,"\n        "),r._UZ(47,"br"),r._uU(48,"\n\n        "),r.YNc(49,Q,34,13,"ng-container",12),r._uU(50,"\n      "),r.BQk()),2&t){const t=r.oxw(2);r.xp6(5),r.hij("\n            ",r.lcZ(6,10,"exportTypeHeading"),"\n          "),r.xp6(7),r.Q6J("value",t.encryptedExportType.AccountEncrypted)("checked",t.fileEncryptionType===t.encryptedExportType.AccountEncrypted),r.xp6(6),r.hij("\n                ",r.lcZ(19,12,"accountRestricted"),"\n              "),r.xp6(6),r.hij("\n            ",r.lcZ(25,14,"accountRestrictedOptionDescription"),"\n          "),r.xp6(7),r.Q6J("value",t.encryptedExportType.FileEncrypted)("checked",t.fileEncryptionType===t.encryptedExportType.FileEncrypted),r.xp6(6),r.Oqu(r.lcZ(38,16,"passwordProtected")),r.xp6(6),r.hij("\n            ",r.lcZ(44,18,"passwordProtectedOptionDescription"),"\n          "),r.xp6(6),r.Q6J("ngIf",t.fileEncryptionType==t.encryptedExportType.FileEncrypted)}}const $=function(t){return{manual:t}};function G(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"form",1,2),r.NdJ("ngSubmit",(function(){r.CHM(t);const e=r.oxw();return r.KtG(e.submit())})),r._uU(2,"\n  "),r.TgZ(3,"div",3),r._uU(4,"\n    "),r.TgZ(5,"h1"),r._uU(6),r.ALo(7,"i18n"),r.qZA(),r._uU(8,"\n  "),r.qZA(),r._uU(9,"\n\n  "),r.YNc(10,j,4,6,"app-callout",4),r._uU(11,"\n  "),r.YNc(12,B,1,1,"app-export-scope-callout",5),r._uU(13,"\n\n  "),r.TgZ(14,"div",6),r._uU(15,"\n    "),r.TgZ(16,"div",7),r._uU(17,"\n      "),r.TgZ(18,"bit-form-field"),r._uU(19,"\n        "),r.TgZ(20,"bit-label",8),r._uU(21),r.ALo(22,"i18n"),r.qZA(),r._uU(23,"\n        "),r.TgZ(24,"select",9),r._uU(25,"\n          "),r.YNc(26,J,2,2,"option",10),r._uU(27,"\n        "),r.qZA(),r._uU(28,"\n      "),r.qZA(),r._uU(29,"\n    "),r.qZA(),r._uU(30,"\n  "),r.qZA(),r._uU(31,"\n  "),r.TgZ(32,"div",6),r._uU(33,"\n    "),r.TgZ(34,"div",11),r._uU(35,"\n      "),r.YNc(36,z,51,20,"ng-container",12),r._uU(37,"\n\n      "),r.TgZ(38,"button",13),r._uU(39,"\n        "),r._UZ(40,"i",14),r.ALo(41,"i18n"),r._uU(42,"\n        "),r.TgZ(43,"span"),r._uU(44),r.ALo(45,"i18n"),r.qZA(),r._uU(46,"\n      "),r.qZA(),r._uU(47,"\n    "),r.qZA(),r._uU(48,"\n  "),r.qZA(),r._uU(49,"\n"),r.qZA()}if(2&t){const t=r.MAs(1),e=r.oxw();r.Q6J("appApiAction",e.formPromise)("formGroup",e.exportForm),r.xp6(6),r.Oqu(r.lcZ(7,12,"exportVault")),r.xp6(4),r.Q6J("ngIf",e.disabledByPolicy),r.xp6(2),r.Q6J("ngIf",!e.disabledByPolicy),r.xp6(9),r.Oqu(r.lcZ(22,14,"fileFormat")),r.xp6(5),r.Q6J("ngForOf",e.formatOptions),r.xp6(10),r.Q6J("ngIf","encrypted_json"===e.format),r.xp6(2),r.Q6J("disabled",t.loading||e.disabledByPolicy)("ngClass",r.VKq(20,$,e.disabledByPolicy)),r.xp6(2),r.s9C("title",r.lcZ(41,16,"loading")),r.xp6(4),r.Oqu(r.lcZ(45,18,"confirmFormat"))}}class M extends b{constructor(t,e,i,o,r,s,c,l,a,p,u){super(t,e,i,o,r,s,window,c,l,a,p,u),this.encryptedExportType=n}submit(){return V(this,void 0,void 0,(function*(){if(this.isFileEncryptedExport&&this.filePassword!=this.confirmFilePassword)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("filePasswordAndConfirmFilePasswordDoNotMatch"));if(this.exportForm.markAllAsTouched(),!this.exportForm.valid)return;if(this.disabledByPolicy)return void this.platformUtilsService.showToast("error",null,this.i18nService.t("personalVaultExportPolicyInEffect"));(yield this.verifyUser())&&this.doExport()}))}saved(){super.saved(),this.platformUtilsService.showToast("success",null,this.i18nService.t("exportSuccess"))}verifyUser(){let t="exportWarningDesc";this.isFileEncryptedExport?t="fileEncryptedExportWarningDesc":this.isAccountEncryptedExport&&(t="encExportKeyWarningDesc");const e=(0,T.CV)(this.dialogService,{data:{confirmDescription:t,confirmButtonText:"exportVault",modalTitle:"confirmVaultExport"}});if(null!=e)return(0,o.z)(e.closed)}get isFileEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===n.FileEncrypted}get isAccountEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===n.AccountEncrypted}}M.ɵfac=function(t){return new(t||M)(r.Y36(y.$),r.Y36(g.D),r.Y36(m.P),r.Y36(f.qX),r.Y36(x.j),r.Y36(v.d),r.Y36(w.$),r.Y36(_.i),r.Y36(s.QS),r.Y36(U._),r.Y36(Z.x))},M.ɵcmp=r.Xpm({type:M,selectors:[["app-export"]],features:[r.qOj],decls:4,vars:1,consts:[[3,"appApiAction","formGroup","ngSubmit",4,"ngIf"],[3,"appApiAction","formGroup","ngSubmit"],["form",""],[1,"page-header"],["type","error",3,"title",4,"ngIf"],[3,"organizationId",4,"ngIf"],[1,"row"],[1,"col-6"],["for","format",1,"tw-text-lg"],["bitInput","","name","format","formControlName","format"],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","col-6"],[4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-submit",3,"disabled","ngClass"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin",3,"title"],["type","error",3,"title"],[3,"organizationId"],[3,"value"],["role","radiogroup","aria-labelledby","exportTypeHeading"],["id","exportTypeHeading",1,"tw-semi-bold","tw-text-lg"],["appBoxRow","","name","FileTypeOptions",1,"tw-flex","tw-items-center"],["type","radio","name","fileEncryptionType","id","AccountEncrypted","formControlName","fileEncryptionType",1,"radio",3,"value","checked"],["for","AccountEncrypted",1,"tw-semi-bold","tw-text-md","tw-my-1","tw-ml-1"],[1,"tw-regular","ml-3","pb-2","tw-text-sm"],[1,"tw-flex","tw-items-center"],["type","radio","name","fileEncryptionType","id","FileEncrypted","formControlName","fileEncryptionType",1,"radio",3,"value","checked"],["for","FileEncrypted",1,"tw-semi-bold","tw-text-md","tw-my-1","tw-ml-1"],[1,"tw-regular","ml-3","tw-text-sm"],[1,"tw-mb-3"],["bitInput","","type","password","id","filePassword","formControlName","filePassword","name","password"],["type","button","bitSuffix","","bitIconButton","","bitPasswordInputToggle","",3,"toggled","toggledChange"],[3,"password","showText"],["bitInput","","type","password","id","confirmFilePassword","formControlName","confirmFilePassword","name","confirmFilePassword"]],template:function(t,e){1&t&&(r._uU(0,"\n"),r._uU(1,"\n"),r.YNc(2,G,50,22,"form",0),r._uU(3,"\n")),2&t&&(r.xp6(2),r.Q6J("ngIf",e.exportForm))},dependencies:[A.mk,A.sg,A.O5,s._Y,s.YN,s.Kr,s.Fj,s.EJ,s._,s.JJ,s.JL,s.sg,s.u,F.b,P.$,S.O,q.N,h.Z,C.d,I.G,Y.w,O.e,D.u,k.M,L.Q,N.C],encapsulation:2})},25376:(t,e,i)=>{i.d(e,{$:()=>o});var n=i(24852);class o{constructor(t){this.el=null,this.el=t.nativeElement}ngOnInit(){this.formEls=Array.from(this.el.querySelectorAll('input:not([type="hidden"]), select, textarea')),this.formEls.forEach((t=>{t.addEventListener("focus",(()=>{this.el.classList.add("active")}),!1),t.addEventListener("blur",(()=>{this.el.classList.remove("active")}),!1)}))}onClick(t){const e=t.target;if((e===this.el||e.classList.contains("progress")||e.classList.contains("progress-bar"))&&this.formEls.length>0){const t=this.formEls[0];if("input"===t.tagName.toLowerCase()){const e=t;if(null!=e.type&&"checkbox"===e.type.toLowerCase())return void e.click()}t.focus()}}}o.ɵfac=function(t){return new(t||o)(n.Y36(n.SBq))},o.ɵdir=n.lG2({type:o,selectors:[["","appBoxRow",""]],hostBindings:function(t,e){1&t&&n.NdJ("click",(function(t){return e.onClick(t)}))}})},90258:(t,e,i)=>{i.d(e,{N:()=>u});var n=i(58691),o=i(24852),r=i(58172),s=i(19419),c=i(53707),l=i(82933),a=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(e){r(e)}}function c(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}l((n=n.apply(t,e||[])).next())}))};function p(t,e){if(1&t&&(o.ynx(0),o._uU(1,"\n  "),o.TgZ(2,"app-callout",1),o.ALo(3,"i18n"),o._uU(4),o.ALo(5,"i18n"),o.qZA(),o._uU(6,"\n"),o.BQk()),2&t){const t=o.oxw();o.xp6(2),o.s9C("title",o.lcZ(3,2,t.scopeConfig.title)),o.xp6(2),o.hij("\n    ",o.xi3(5,4,t.scopeConfig.description,t.scopeConfig.scopeIdentifier),"\n  ")}}class u{constructor(t,e){this.organizationService=t,this.stateService=e,this.organizationId=null,this.show=!1}ngOnInit(){return a(this,void 0,void 0,(function*(){this.organizationService.hasOrganizations()&&(this.scopeConfig=null!=this.organizationId?{title:"exportingOrganizationVaultTitle",description:"exportingOrganizationVaultDesc",scopeIdentifier:this.organizationService.get(this.organizationId).name}:{title:"exportingPersonalVaultTitle",description:"exportingIndividualVaultDescription",scopeIdentifier:yield this.stateService.getEmail()},this.show=!0)}))}}u.ɵfac=function(t){return new(t||u)(o.Y36(n.Mn),o.Y36(r.b))},u.ɵcmp=o.Xpm({type:u,selectors:[["app-export-scope-callout"]],inputs:{organizationId:"organizationId"},decls:2,vars:1,consts:[[4,"ngIf"],["type","info",3,"title"]],template:function(t,e){1&t&&(o.YNc(0,p,7,7,"ng-container",0),o._uU(1,"\n")),2&t&&o.Q6J("ngIf",e.show)},dependencies:[s.O5,c.O,l.C],encapsulation:2})}}]);
//# sourceMappingURL=111.0ef75c614d5cdd9a3549.js.map