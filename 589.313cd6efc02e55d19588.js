"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[589],{56992:(e,i,t)=>{t.d(i,{S:()=>s});var n=t(58691),o=t(24852),l=t(75557),r=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};class s{constructor(e,i){this.router=e,this.organizationService=i}canActivate(e,i){var t;return r(this,void 0,void 0,(function*(){const o=this.organizationService.get(e.params.organizationId),l=null===(t=e.data)||void 0===t?void 0:t.autoRedirectCallback;if(l){let e=l(o);return"string"==typeof e&&(e=[e]),this.router.createUrlTree([i.url,...e])}return(0,n.gW)(o)?this.router.createUrlTree(["/organizations",o.id]):this.router.createUrlTree(["/"])}))}}s.ɵfac=function(e){return new(e||s)(o.LFG(l.F0),o.LFG(n.Mn))},s.ɵprov=o.Yz7({token:s,factory:s.ɵfac,providedIn:"root"})},74589:(e,i,t)=>{t.r(i),t.d(i,{OrganizationModule:()=>un});var n,o,l=t(63078),r=t(75557),s=t(66463),c=t(58691),a=t(47064),u=t(56992),d=t(35660),h=t(24852),p=t(54019),g=t(59554),f=t(80060),m=t(30359),v=t(33031),b=t(59260),U=t(59157),Z=t(92786),_=t(68362),w=t(70032),A=t(19887),y=t(5712),x=t(27646),C=t(68134),T=t(54193),S=t(65017),I=t(98645),q=t(92716),z=t(79596),M=t(59281),J=t(25679),L=t(14309),F=t(55602),Y=t(47244),O=t(78627),k=t(31754),G=t(99721),N=t(66459),D=t(73369),$=t(23915),E=t(19419),Q=t(33245),P=t(62374),R=t(98205),B=t(46246),H=t(36338),j=t(81974),K=t(29465),W=t(18362),V=t(24637),X=t(11512),ee=t(36179),ie=t(44358),te=t(21656),ne=t(17731),oe=t(26536),le=t(30674),re=t(82933),se=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};function ce(e,i){if(1&e&&(h.TgZ(0,"span",11),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(1),h.Oqu(null==e.group?null:e.group.name)}}function ae(e,i){1&e&&(h.TgZ(0,"div"),h._uU(1,"\n        "),h._UZ(2,"i",12),h.ALo(3,"i18n"),h._uU(4,"\n        "),h.TgZ(5,"span",13),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n      "),h.qZA()),2&e&&(h.xp6(2),h.s9C("title",h.lcZ(3,2,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,4,"loading")))}function ue(e,i){if(1&e&&(h.ynx(0),h._uU(1,"\n            "),h._UZ(2,"bit-access-selector",23),h.ALo(3,"i18n"),h.ALo(4,"i18n"),h.ALo(5,"i18n"),h.ALo(6,"async"),h._uU(7,"\n          "),h.BQk()),2&e){const e=h.oxw(2);h.xp6(2),h.Q6J("items",e.collections)("permissionMode",e.PermissionMode.Edit)("columnHeader",h.lcZ(3,6,"collection"))("selectorLabelText",h.lcZ(4,8,"selectCollections"))("emptySelectionText",h.lcZ(5,10,"noCollectionsAdded"))("flexibleCollectionsEnabled",h.lcZ(6,12,e.flexibleCollectionsEnabled$))}}function de(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"bit-tab-group",14),h.NdJ("selectedIndexChange",(function(i){h.CHM(e);const t=h.oxw();return h.KtG(t.tabIndex=i)})),h._uU(1,"\n        "),h.TgZ(2,"bit-tab",15),h.ALo(3,"i18n"),h._uU(4,"\n          "),h.TgZ(5,"bit-form-field"),h._uU(6,"\n            "),h.TgZ(7,"bit-label"),h._uU(8),h.ALo(9,"i18n"),h.qZA(),h._uU(10,"\n            "),h._UZ(11,"input",16),h._uU(12,"\n            "),h.TgZ(13,"bit-hint"),h._uU(14),h.ALo(15,"i18n"),h.qZA(),h._uU(16,"\n          "),h.qZA(),h._uU(17,"\n          "),h.TgZ(18,"bit-form-field"),h._uU(19,"\n            "),h.TgZ(20,"bit-label"),h._uU(21),h.ALo(22,"i18n"),h.qZA(),h._uU(23,"\n            "),h._UZ(24,"input",17),h._uU(25,"\n            "),h.TgZ(26,"bit-hint"),h._uU(27),h.ALo(28,"i18n"),h.qZA(),h._uU(29,"\n          "),h.qZA(),h._uU(30,"\n        "),h.qZA(),h._uU(31,"\n\n        "),h.TgZ(32,"bit-tab",15),h.ALo(33,"i18n"),h._uU(34,"\n          "),h.TgZ(35,"p"),h._uU(36),h.ALo(37,"i18n"),h.qZA(),h._uU(38,"\n          "),h._UZ(39,"bit-access-selector",18),h.ALo(40,"i18n"),h.ALo(41,"i18n"),h.ALo(42,"i18n"),h.ALo(43,"async"),h._uU(44,"\n        "),h.qZA(),h._uU(45,"\n\n        "),h.TgZ(46,"bit-tab",15),h.ALo(47,"i18n"),h._uU(48,"\n          "),h.TgZ(49,"p"),h._uU(50),h.ALo(51,"i18n"),h.qZA(),h._uU(52,"\n          "),h.TgZ(53,"div",19),h._uU(54,"\n            "),h._UZ(55,"input",20),h._uU(56,"\n            "),h.TgZ(57,"label",21),h._uU(58),h.ALo(59,"i18n"),h.qZA(),h._uU(60,"\n            "),h.TgZ(61,"p",22),h._uU(62),h.ALo(63,"i18n"),h.qZA(),h._uU(64,"\n          "),h.qZA(),h._uU(65,"\n          "),h.YNc(66,ue,8,14,"ng-container",5),h._uU(67,"\n        "),h.qZA(),h._uU(68,"\n      "),h.qZA()}if(2&e){const e=h.oxw();h.Q6J("selectedIndex",e.tabIndex),h.xp6(2),h.s9C("label",h.lcZ(3,20,"groupInfo")),h.xp6(6),h.Oqu(h.lcZ(9,22,"name")),h.xp6(6),h.Oqu(h.xi3(15,24,"characterMaximum",100)),h.xp6(7),h.Oqu(h.lcZ(22,27,"externalId")),h.xp6(6),h.Oqu(h.lcZ(28,29,"externalIdDesc")),h.xp6(5),h.s9C("label",h.lcZ(33,31,"members")),h.xp6(4),h.Oqu(h.lcZ(37,33,"editGroupMembersDesc")),h.xp6(3),h.Q6J("items",e.members)("showMemberRoles",!0)("permissionMode",e.PermissionMode.Hidden)("columnHeader",h.lcZ(40,35,"member"))("selectorLabelText",h.lcZ(41,37,"selectMembers"))("emptySelectionText",h.lcZ(42,39,"noMembersAdded"))("flexibleCollectionsEnabled",h.lcZ(43,41,e.flexibleCollectionsEnabled$)),h.xp6(7),h.s9C("label",h.lcZ(47,43,"collections")),h.xp6(4),h.Oqu(h.lcZ(51,45,"editGroupCollectionsDesc")),h.xp6(8),h.Oqu(h.lcZ(59,47,"accessAllCollectionsDesc")),h.xp6(4),h.Oqu(h.lcZ(63,49,"accessAllCollectionsHelp")),h.xp6(4),h.Q6J("ngIf",!e.groupForm.value.accessAll)}}!function(e){e[e.Info=0]="Info",e[e.Members=1]="Members",e[e.Collections=2]="Collections"}(n||(n={})),function(e){e.Saved="saved",e.Canceled="canceled",e.Deleted="deleted"}(o||(o={}));class he{get groupId(){return this.params.groupId}get organizationId(){return this.params.organizationId}get orgCollections$(){return(0,b.D)(this.apiService.getCollections(this.organizationId)).pipe((0,m.w)((e=>(0,b.D)(this.collectionService.decryptMany(e.data.map((e=>new T.F(new C.Z(e)))))))),(0,Z.U)((e=>e.map((e=>({id:e.id,type:L.zD.Collection,labelName:e.name,listName:e.name}))))))}get orgMembers$(){return(0,b.D)(this.organizationUserService.getAllUsers(this.organizationId)).pipe((0,Z.U)((e=>e.data.map((e=>{var i;return{id:e.id,type:L.zD.Member,email:e.email,role:e.type,listName:(null===(i=e.name)||void 0===i?void 0:i.length)>0?`${e.name} (${e.email})`:e.email,labelName:e.name||e.email,status:e.status}})))))}get groupDetails$(){return this.editMode?(0,v.a)([this.groupService.get(this.organizationId,this.groupId),this.apiService.getGroupUsers(this.organizationId,this.groupId)]).pipe((0,Z.U)((([e,i])=>(e.members=i,e))),(0,z.K)((e=>(e instanceof J.i?this.logService.error(e.message):this.logService.error(e.toString()),(0,q.of)(void 0))))):(0,q.of)(void 0)}constructor(e,i,t,r,s,c,a,u,d,h,g,f,m){var v;this.params=e,this.dialogRef=i,this.apiService=t,this.organizationUserService=r,this.groupService=s,this.i18nService=c,this.collectionService=a,this.platformUtilsService=u,this.logService=d,this.formBuilder=h,this.changeDetectorRef=g,this.dialogService=f,this.configService=m,this.flexibleCollectionsEnabled$=this.configService.getFeatureFlag$(M.T.FlexibleCollections,!1),this.PermissionMode=L.R9,this.ResultType=o,this.loading=!0,this.editMode=!1,this.collections=[],this.members=[],this.groupForm=this.formBuilder.group({accessAll:[!1],name:["",[I.kI.required,I.kI.maxLength(100)]],externalId:this.formBuilder.control({value:"",disabled:!0}),members:[[]],collections:[[]]}),this.destroy$=new p.x,this.submit=()=>se(this,void 0,void 0,(function*(){var e,i;if(this.groupForm.markAllAsTouched(),this.groupForm.invalid)return void(this.tabIndex!==n.Info&&this.platformUtilsService.showToast("error",null,this.i18nService.t("fieldOnTabRequiresAttention",this.i18nService.t("groupInfo"))));const t=new l.Rq;t.id=this.groupId,t.organizationId=this.organizationId;const r=this.groupForm.value;t.name=r.name,t.accessAll=r.accessAll,t.members=null!==(i=null===(e=r.members)||void 0===e?void 0:e.map((e=>e.id)))&&void 0!==i?i:[],t.accessAll||(t.collections=r.collections.map((e=>(0,L.E2)(e)))),yield this.groupService.save(t),this.platformUtilsService.showToast("success",null,this.i18nService.t(this.editMode?"editedGroupId":"createdGroupId",r.name)),this.dialogRef.close(o.Saved)})),this.delete=()=>se(this,void 0,void 0,(function*(){if(!this.editMode)return;if(!(yield this.dialogService.openSimpleDialog({title:this.group.name,content:{key:"deleteGroupConfirmation"},type:"warning"})))return!1;yield this.groupService.delete(this.organizationId,this.groupId),this.platformUtilsService.showToast("success",null,this.i18nService.t("deletedGroupId",this.group.name)),this.dialogRef.close(o.Deleted)})),this.tabIndex=null!==(v=e.initialTab)&&void 0!==v?v:n.Info}ngOnInit(){this.editMode=this.loading=null!=this.groupId,this.title=this.i18nService.t(this.editMode?"editGroup":"newGroup"),(0,v.a)([this.orgCollections$,this.orgMembers$,this.groupDetails$]).pipe((0,_.R)(this.destroy$)).subscribe((([e,i,t])=>{this.collections=e,this.members=i,this.group=t,null!=this.group&&(this.changeDetectorRef.detectChanges(),this.groupForm.patchValue({name:this.group.name,externalId:this.group.externalId,accessAll:this.group.accessAll,members:this.group.members.map((e=>({id:e,type:L.zD.Member}))),collections:this.group.collections.map((e=>({id:e.id,type:L.zD.Collection,permission:(0,L.d4)(e)})))})),this.loading=!1}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}he.ɵfac=function(e){return new(e||he)(h.Y36(S.Kt),h.Y36(S.zj),h.Y36(F.s),h.Y36(Y.t),h.Y36(l.My),h.Y36(O.D),h.Y36(k.a),h.Y36(G.P),h.Y36(N.$),h.Y36(I.qu),h.Y36(h.sBO),h.Y36(D.x),h.Y36($.i))},he.ɵcmp=h.Xpm({type:he,selectors:[["app-group-add-edit"]],decls:32,vars:18,consts:[[3,"formGroup","bitSubmit"],["dialogSize","large",3,"disablePadding"],["bitDialogTitle",""],["class","tw-text-sm tw-normal-case tw-text-muted",4,"ngIf"],["bitDialogContent",""],[4,"ngIf"],[3,"selectedIndex","selectedIndexChange",4,"ngIf"],["bitDialogFooter",""],["bitButton","","buttonType","primary","bitFormButton","","type","submit"],["bitButton","","buttonType","secondary","type","button",3,"bitDialogClose"],["type","button","buttonType","danger","bitIconButton","bwi-trash","bitFormButton","",1,"tw-ml-auto",3,"bitAction","appA11yTitle"],[1,"tw-text-sm","tw-normal-case","tw-text-muted"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","text-muted",3,"title"],[1,"sr-only"],[3,"selectedIndex","selectedIndexChange"],[3,"label"],["bitInput","","appAutofocus","","type","text","formControlName","name"],["bitInput","","type","text","formControlName","externalId"],["formControlName","members",3,"items","showMemberRoles","permissionMode","columnHeader","selectorLabelText","emptySelectionText","flexibleCollectionsEnabled"],[1,"tw-my-3"],["type","checkbox","formControlName","accessAll","id","accessAll"],["for","accessAll",1,"tw-mb-0","tw-text-lg"],[1,"tw-my-0","tw-text-muted"],["formControlName","collections",3,"items","permissionMode","columnHeader","selectorLabelText","emptySelectionText","flexibleCollectionsEnabled"]],template:function(e,i){1&e&&(h.TgZ(0,"form",0),h._uU(1,"\n  "),h.TgZ(2,"bit-dialog",1),h._uU(3,"\n    "),h.TgZ(4,"span",2),h._uU(5),h.YNc(6,ce,2,1,"span",3),h._uU(7,"\n    "),h.qZA(),h._uU(8,"\n    "),h.TgZ(9,"div",4),h._uU(10,"\n      "),h.YNc(11,ae,9,6,"div",5),h._uU(12,"\n\n      "),h.YNc(13,de,69,51,"bit-tab-group",6),h._uU(14,"\n    "),h.qZA(),h._uU(15,"\n    "),h.ynx(16,7),h._uU(17,"\n      "),h.TgZ(18,"button",8),h._uU(19),h.ALo(20,"i18n"),h.qZA(),h._uU(21,"\n      "),h.TgZ(22,"button",9),h._uU(23),h.ALo(24,"i18n"),h.qZA(),h._uU(25,"\n      "),h._UZ(26,"button",10),h.ALo(27,"i18n"),h._uU(28,"\n    "),h.BQk(),h._uU(29,"\n  "),h.qZA(),h._uU(30,"\n"),h.qZA(),h._uU(31,"\n")),2&e&&(h.Q6J("formGroup",i.groupForm)("bitSubmit",i.submit),h.xp6(2),h.Q6J("disablePadding",!i.loading),h.xp6(3),h.hij("\n      ",i.title,"\n      "),h.xp6(1),h.Q6J("ngIf",i.editMode),h.xp6(5),h.Q6J("ngIf",i.loading),h.xp6(2),h.Q6J("ngIf",!i.loading),h.xp6(6),h.hij("\n        ",h.lcZ(20,12,"save"),"\n      "),h.xp6(3),h.Q6J("bitDialogClose",i.ResultType.Canceled),h.xp6(1),h.hij("\n        ",h.lcZ(24,14,"cancel"),"\n      "),h.xp6(3),h.Q6J("bitAction",i.delete)("appA11yTitle",h.lcZ(27,16,"delete")))},dependencies:[E.O5,I._Y,I.Fj,I.Wl,I.JJ,I.JL,I.sg,I.u,Q.B,P.U,R.Q,B.b,H.u,j.r,K.a,W.f,V.d,X.G,ee.u,ie.M,te.Q,ne.Q,oe.i,le.f,E.Ov,re.C],encapsulation:2});var pe=t(51430),ge=t(56617),fe=t(1874),me=t(7172),ve=t(12492),be=t(73974),Ue=t(26194),Ze=t(44234),_e=t(54735),we=t(50941),Ae=t(26361),ye=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};const xe=["addEdit"],Ce=["usersTemplate"];function Te(e,i){1&e&&(h.ynx(0),h._uU(1,"\n    "),h._UZ(2,"i",12),h.ALo(3,"i18n"),h._uU(4,"\n    "),h.TgZ(5,"span",4),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n  "),h.BQk()),2&e&&(h.xp6(2),h.s9C("title",h.lcZ(3,2,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,4,"loading")))}function Se(e,i){1&e&&(h.TgZ(0,"p"),h._uU(1),h.ALo(2,"i18n"),h.qZA()),2&e&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"noGroupsInList")))}function Ie(e,i){if(1&e&&h._UZ(0,"bit-badge-list",38),2&e){const e=h.oxw().$implicit;h.Q6J("items",e.collectionNames)("maxItems",3)}}function qe(e,i){1&e&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"i18n"),h.qZA()),2&e&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"all")))}function ze(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"tr",28),h._uU(1,"\n          "),h.TgZ(2,"td",29),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.check(i))})),h._uU(3,"\n            "),h.TgZ(4,"input",30),h.NdJ("ngModelChange",(function(i){const t=h.CHM(e).$implicit;return h.KtG(t.checked=i)})),h.qZA(),h._uU(5,"\n          "),h.qZA(),h._uU(6,"\n          "),h.TgZ(7,"td",31),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i))})),h._uU(8,"\n            "),h.TgZ(9,"button",32),h._uU(10),h.qZA(),h._uU(11,"\n          "),h.qZA(),h._uU(12,"\n          "),h.TgZ(13,"td",29),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i,t.ModalTabType.Collections))})),h._uU(14,"\n            "),h.YNc(15,Ie,1,2,"bit-badge-list",33),h._uU(16,"\n            "),h.YNc(17,qe,3,3,"span",10),h._uU(18,"\n          "),h.qZA(),h._uU(19,"\n          "),h.TgZ(20,"td",19),h._uU(21,"\n            "),h._UZ(22,"button",21),h.ALo(23,"i18n"),h._uU(24,"\n\n            "),h.TgZ(25,"bit-menu",null,34),h._uU(27,"\n              "),h.TgZ(28,"button",23),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i))})),h._uU(29,"\n                "),h._UZ(30,"i",35),h._uU(31),h.ALo(32,"i18n"),h.qZA(),h._uU(33,"\n              "),h.TgZ(34,"button",23),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i,t.ModalTabType.Members))})),h._uU(35,"\n                "),h._UZ(36,"i",36),h._uU(37),h.ALo(38,"i18n"),h.qZA(),h._uU(39,"\n              "),h.TgZ(40,"button",23),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i,t.ModalTabType.Collections))})),h._uU(41,"\n                "),h._UZ(42,"i",37),h._uU(43),h.ALo(44,"i18n"),h.qZA(),h._uU(45,"\n              "),h.TgZ(46,"button",23),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.delete(i))})),h._uU(47,"\n                "),h.TgZ(48,"span",24),h._UZ(49,"i",25),h._uU(50),h.ALo(51,"i18n"),h.qZA(),h._uU(52,"\n              "),h.qZA(),h._uU(53,"\n            "),h.qZA(),h._uU(54,"\n          "),h.qZA(),h._uU(55,"\n        "),h.qZA()}if(2&e){const e=i.$implicit,t=h.MAs(26);h.xp6(4),h.Q6J("ngModel",e.checked),h.xp6(6),h.hij("\n              ",e.details.name,"\n            "),h.xp6(5),h.Q6J("ngIf",!e.details.accessAll),h.xp6(2),h.Q6J("ngIf",e.details.accessAll),h.xp6(5),h.s9C("appA11yTitle",h.lcZ(23,10,"options")),h.Q6J("bitMenuTriggerFor",t),h.xp6(9),h.hij(" ",h.lcZ(32,12,"editInfo"),"\n              "),h.xp6(6),h.hij(" ",h.lcZ(38,14,"members"),"\n              "),h.xp6(6),h.hij(" ",h.lcZ(44,16,"collections"),"\n              "),h.xp6(7),h.hij(" ",h.lcZ(51,18,"delete"),"")}}function Me(e,i){if(1&e&&(h._uU(0,"\n        "),h.YNc(1,ze,56,20,"tr",27),h._uU(2,"\n      ")),2&e){const e=h.oxw(3);h.xp6(1),h.Q6J("ngForOf",e.visibleGroups)}}function Je(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"bit-table",14),h.NdJ("scrolled",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.loadMore())})),h._uU(1,"\n      "),h.ynx(2,15),h._uU(3,"\n        "),h.TgZ(4,"tr"),h._uU(5,"\n          "),h.TgZ(6,"th",16),h._uU(7,"\n            "),h.TgZ(8,"input",17),h.NdJ("change",(function(i){h.CHM(e);const t=h.oxw(2);return h.KtG(t.toggleAllVisible(i))})),h.qZA(),h._uU(9,"\n            "),h.TgZ(10,"label",18),h._uU(11),h.ALo(12,"i18n"),h.qZA(),h._uU(13,"\n          "),h.qZA(),h._uU(14,"\n          "),h.TgZ(15,"th",19),h._uU(16),h.ALo(17,"i18n"),h.qZA(),h._uU(18,"\n          "),h.TgZ(19,"th",19),h._uU(20),h.ALo(21,"i18n"),h.qZA(),h._uU(22,"\n          "),h.TgZ(23,"th",20),h._uU(24,"\n            "),h._UZ(25,"button",21),h.ALo(26,"i18n"),h._uU(27,"\n\n            "),h.TgZ(28,"bit-menu",null,22),h._uU(30,"\n              "),h.TgZ(31,"button",23),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.deleteAllSelected())})),h._uU(32,"\n                "),h.TgZ(33,"span",24),h._UZ(34,"i",25),h._uU(35),h.ALo(36,"i18n"),h.qZA(),h._uU(37,"\n              "),h.qZA(),h._uU(38,"\n            "),h.qZA(),h._uU(39,"\n          "),h.qZA(),h._uU(40,"\n        "),h.qZA(),h._uU(41,"\n      "),h.BQk(),h._uU(42,"\n      "),h.YNc(43,Me,3,1,"ng-template",26),h._uU(44,"\n    "),h.qZA()}if(2&e){const e=h.MAs(29),i=h.oxw(2);h.Q6J("infiniteScrollDistance",1)("infiniteScrollDisabled",!i.isPaging()),h.xp6(11),h.Oqu(h.lcZ(12,8,"all")),h.xp6(5),h.Oqu(h.lcZ(17,10,"name")),h.xp6(4),h.Oqu(h.lcZ(21,12,"collections")),h.xp6(5),h.s9C("appA11yTitle",h.lcZ(26,14,"options")),h.Q6J("bitMenuTriggerFor",e),h.xp6(10),h.hij(" ",h.lcZ(36,16,"delete"),"")}}function Le(e,i){if(1&e&&(h.ynx(0),h._uU(1,"\n    "),h.YNc(2,Se,3,3,"p",10),h._uU(3,"\n    "),h.YNc(4,Je,45,18,"bit-table",13),h._uU(5,"\n  "),h.BQk()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("ngIf",!e.visibleGroups.length),h.xp6(2),h.Q6J("ngIf",e.visibleGroups.length)}}function Fe(e,i){}class Ye{get searchText(){return this._searchText}set searchText(e){this._searchText=e,this.updateSearchedGroups()}get visibleGroups(){return this.isPaging()?this.pagedGroups:this.isSearching()?this.searchedGroups:this.groups}constructor(e,i,t,o,l,r,s,c,a,u){this.apiService=e,this.groupService=i,this.route=t,this.i18nService=o,this.dialogService=l,this.platformUtilsService=r,this.searchService=s,this.logService=c,this.collectionService=a,this.searchPipe=u,this.loading=!0,this.didScroll=!1,this.pageSize=100,this.ModalTabType=n,this.pagedGroupsCount=0,this.destroy$=new p.x,this.refreshGroups$=new g.X(null)}ngOnInit(){return ye(this,void 0,void 0,(function*(){this.route.params.pipe((0,f.b)((e=>this.organizationId=e.organizationId)),(0,m.w)((()=>(0,v.a)([(0,b.D)(this.apiService.getCollections(this.organizationId)).pipe((0,U.b)((e=>this.toCollectionMap(e)))),this.refreshGroups$.pipe((0,m.w)((()=>this.groupService.getAll(this.organizationId))))]))),(0,Z.U)((([e,i])=>i.sort(x.c.getSortFunction(this.i18nService,"name")).map((i=>{var t;return{id:i.id,name:i.name,details:i,checked:!1,collectionNames:i.collections.map((i=>{var t;return null===(t=e[i.id])||void 0===t?void 0:t.name})).sort(null===(t=this.i18nService.collator)||void 0===t?void 0:t.compare)}})))),(0,_.R)(this.destroy$)).subscribe((e=>{this.groups=e,this.resetPaging(),this.updateSearchedGroups(),this.loading=!1})),this.route.queryParams.pipe((0,A.P)(),(0,U.b)((e=>ye(this,void 0,void 0,(function*(){this.searchText=e.search})))),(0,_.R)(this.destroy$)).subscribe()}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadMore(){if(!this.groups||this.groups.length<=this.pageSize)return;const e=this.pagedGroups.length;let i=this.pageSize;0===e&&this.pagedGroupsCount>this.pageSize&&(i=this.pagedGroupsCount),this.groups.length>e&&(this.pagedGroups=this.pagedGroups.concat(this.groups.slice(e,e+i))),this.pagedGroupsCount=this.pagedGroups.length,this.didScroll=this.pagedGroups.length>this.pageSize}edit(e,i=n.Info){return ye(this,void 0,void 0,(function*(){const t=(n=this.dialogService,l={data:{initialTab:i,organizationId:this.organizationId,groupId:null!=e?e.details.id:null}},n.open(he,l));var n,l;const r=yield(0,w.n)(t.closed);r==o.Saved?this.refreshGroups$.next():r==o.Deleted&&this.removeGroup(e.details.id)}))}add(){this.edit(null)}delete(e){return ye(this,void 0,void 0,(function*(){if(!(yield this.dialogService.openSimpleDialog({title:e.details.name,content:{key:"deleteGroupConfirmation"},type:"warning"})))return!1;try{yield this.groupService.delete(this.organizationId,e.details.id),this.platformUtilsService.showToast("success",null,this.i18nService.t("deletedGroupId",e.details.name)),this.removeGroup(e.details.id)}catch(i){this.logService.error(i)}}))}deleteAllSelected(){return ye(this,void 0,void 0,(function*(){const e=this.groups.filter((e=>e.checked));if(0==e.length)return;const i=e.map((e=>e.details.name)).join(", ");if(!(yield this.dialogService.openSimpleDialog({title:{key:"deleteMultipleGroupsConfirmation",placeholders:[e.length.toString()]},content:i,type:"warning"})))return!1;try{yield this.groupService.deleteMany(this.organizationId,e.map((e=>e.details.id))),this.platformUtilsService.showToast("success",null,this.i18nService.t("deletedManyGroups",e.length.toString())),e.forEach((e=>this.removeGroup(e.details.id)))}catch(t){this.logService.error(t)}}))}resetPaging(){this.pagedGroups=[],this.loadMore()}isSearching(){return this.searchService.isSearchable(this.searchText)}check(e){e.checked=!e.checked}toggleAllVisible(e){this.visibleGroups.forEach((i=>i.checked=e.target.checked))}isPaging(){const e=this.isSearching();return e&&this.didScroll&&this.resetPaging(),!e&&this.groups&&this.groups.length>this.pageSize}removeGroup(e){const i=this.groups.findIndex((i=>i.details.id===e));i>-1&&(this.groups.splice(i,1),this.resetPaging(),this.updateSearchedGroups())}toCollectionMap(e){return ye(this,void 0,void 0,(function*(){const i=e.data.map((e=>new T.F(new C.Z(e)))),t=yield this.collectionService.decryptMany(i),n={};return t.forEach((e=>n[e.id]=e)),n}))}updateSearchedGroups(){this.searchService.isSearchable(this.searchText)&&(this.searchedGroups=this.searchPipe.transform(this.groups,this.searchText,(e=>e.details.name),(e=>e.details.id)))}}Ye.ɵfac=function(e){return new(e||Ye)(h.Y36(F.s),h.Y36(l.My),h.Y36(r.gz),h.Y36(O.D),h.Y36(D.x),h.Y36(G.P),h.Y36(pe.o),h.Y36(N.$),h.Y36(k.a),h.Y36(y.C))},Ye.ɵcmp=h.Xpm({type:Ye,selectors:[["app-org-groups"]],viewQuery:function(e,i){if(1&e&&(h.Gf(xe,7,h.s_b),h.Gf(Ce,7,h.s_b)),2&e){let e;h.iGM(e=h.CRH())&&(i.addEditModalRef=e.first),h.iGM(e=h.CRH())&&(i.usersModalRef=e.first)}},decls:41,vars:15,consts:[[1,"container","page-content"],[1,"tw-mb-4","tw-flex"],[1,"tw-ml-auto","tw-flex","tw-items-center"],[1,"tw-mr-2"],[1,"sr-only"],[1,"tw-flex","tw-items-center"],["aria-hidden","true",1,"bwi","bwi-search","bwi-fw","tw-z-20","-tw-mr-7","tw-text-muted"],["bitInput","","type","search",1,"tw-rounded-l","tw-pl-9",3,"placeholder","ngModel","ngModelChange"],["bitButton","","type","button","buttonType","primary",3,"click"],["aria-hidden","true",1,"bwi","bwi-plus","bwi-fw"],[4,"ngIf"],["addEdit",""],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","text-muted",3,"title"],["infinite-scroll","",3,"infiniteScrollDistance","infiniteScrollDisabled","scrolled",4,"ngIf"],["infinite-scroll","",3,"infiniteScrollDistance","infiniteScrollDisabled","scrolled"],["header",""],["bitCell","",1,"tw-w-20"],["type","checkbox","bitCheckbox","","id","selectAll",1,"tw-mr-2",3,"change"],["for","selectAll",1,"tw-mb-0","!tw-font-bold","!tw-text-muted"],["bitCell",""],["bitCell","",1,"tw-w-10"],["type","button","bitIconButton","bwi-ellipsis-v","size","small",3,"bitMenuTriggerFor","appA11yTitle"],["headerMenu",""],["type","button","bitMenuItem","",3,"click"],[1,"tw-text-danger"],["aria-hidden","true",1,"bwi","bwi-trash"],["body",""],["bitRow","",4,"ngFor","ngForOf"],["bitRow",""],["bitCell","",1,"tw-cursor-pointer",3,"click"],["type","checkbox","bitCheckbox","",3,"ngModel","ngModelChange"],["bitCell","",1,"tw-cursor-pointer","tw-font-bold",3,"click"],["type","button","bitLink",""],["badgeType","secondary",3,"items","maxItems",4,"ngIf"],["rowMenu",""],["aria-hidden","true",1,"bwi","bwi-pencil-square"],["aria-hidden","true",1,"bwi","bwi-user"],["aria-hidden","true",1,"bwi","bwi-collection"],["badgeType","secondary",3,"items","maxItems"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div",1),h._uU(3,"\n    "),h.TgZ(4,"h1"),h._uU(5),h.ALo(6,"i18n"),h.qZA(),h._uU(7,"\n    "),h.TgZ(8,"div",2),h._uU(9,"\n      "),h.TgZ(10,"div",3),h._uU(11,"\n        "),h.TgZ(12,"label",4),h._uU(13),h.ALo(14,"i18n"),h.qZA(),h._uU(15,"\n        "),h.TgZ(16,"div",5),h._uU(17,"\n          "),h._UZ(18,"i",6),h._uU(19,"\n          "),h.TgZ(20,"input",7),h.NdJ("ngModelChange",(function(e){return i.searchText=e})),h.ALo(21,"i18n"),h.qZA(),h._uU(22,"\n        "),h.qZA(),h._uU(23,"\n      "),h.qZA(),h._uU(24,"\n      "),h.TgZ(25,"button",8),h.NdJ("click",(function(){return i.add()})),h._uU(26,"\n        "),h._UZ(27,"i",9),h._uU(28),h.ALo(29,"i18n"),h.qZA(),h._uU(30,"\n    "),h.qZA(),h._uU(31,"\n  "),h.qZA(),h._uU(32,"\n  "),h.YNc(33,Te,9,6,"ng-container",10),h._uU(34,"\n  "),h.YNc(35,Le,6,2,"ng-container",10),h._uU(36,"\n  "),h.YNc(37,Fe,0,0,"ng-template",null,11,h.W1O),h._uU(39,"\n"),h.qZA(),h._uU(40,"\n")),2&e&&(h.xp6(5),h.Oqu(h.lcZ(6,7,"groups")),h.xp6(8),h.Oqu(h.lcZ(14,9,"search")),h.xp6(7),h.s9C("placeholder",h.lcZ(21,11,"searchGroups")),h.Q6J("ngModel",i.searchText),h.xp6(8),h.hij("\n        ",h.lcZ(29,13,"newGroup"),"\n      "),h.xp6(5),h.Q6J("ngIf",i.loading),h.xp6(2),h.Q6J("ngIf",!i.loading&&i.visibleGroups))},dependencies:[E.sg,E.O5,I.Fj,I.Wl,I.JJ,I.On,ge.Ry,Q.B,fe.b,j.r,me.b,X.G,te.Q,ve._,be.M,Ue.t,Ze.e,_e.a,we.Y,Ae.v,_e.f,re.C],encapsulation:2});var Oe=t(40857),ke=t(99817),Ge=t(85921),Ne=t(63391),De=t(21151),$e=t(74690),Ee=t(35504),Qe=t(16857),Pe=t(11667),Re=t(75028),Be=t(98913),He=t(56110),je=t(37099),Ke=t(88409),We=t(72530),Ve=t(23031),Xe=t(92236),ei=t(83924),ii=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};class ti extends We.n{constructor(e,i,t,n,o,l,r){super(e,i,t,n,o,l),this.collectionAdminService=r,this.destroy$=new p.x,this._collections=new He.t(1),this.filteredCollections$=this._collections.asObservable(),this.collectionTree$=this.filteredCollections$.pipe((0,Z.U)((e=>this.buildCollectionTree(e))))}reloadCollections(e){return ii(this,void 0,void 0,(function*(){this._collections.next(e)}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}ti.ɵfac=function(e){return new(e||ti)(h.LFG(je.b2),h.LFG(c.Mn),h.LFG(Ve.s),h.LFG(Xe.u),h.LFG(ei.d),h.LFG(O.D),h.LFG(Ke.m))},ti.ɵprov=h.Yz7({token:ti,factory:ti.ɵfac});class ni{}ni.ɵfac=function(e){return new(e||ni)},ni.ɵmod=h.oAB({type:ni}),ni.ɵinj=h.cJS({providers:[{provide:Re.n,useClass:ti}],imports:[Be.d]});var oi=t(99042),li=t(67775),ri=t(72591),si=t(84598),ci=t(27027),ai=t(77494),ui=t(82083),di=t(57673),hi=t(72285),pi=t(83505),gi=t(25406),fi=t(33287),mi=t(27643),vi=t(95607),bi=t(91480),Ui=t(37417),Zi=t(95638),_i=t(4003),wi=t(16776),Ai=t(75230),yi=t(24415),xi=t(61265),Ci=t(19572),Ti=t(77140),Si=t(76528),Ii=t(58172),qi=t(53481),zi=t(24610),Mi=t(2051),Ji=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};function Li(e,i){if(1&e&&(h.TgZ(0,"small"),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(1),h.Oqu(e.cipher.name)}}function Fi(e,i){1&e&&h._UZ(0,"i",24)}function Yi(e,i){1&e&&h._UZ(0,"i",25)}function Oi(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div",26),h._uU(1,"\n                    "),h.TgZ(2,"a",27),h._uU(3,"\n                      "),h._UZ(4,"i",28),h.ALo(5,"i18n"),h._uU(6,"\n                      "),h.TgZ(7,"span",29),h._uU(8),h.ALo(9,"i18n"),h.qZA()(),h._uU(10,"\n                    "),h.TgZ(11,"button",30,31),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw().$implicit,t=h.oxw(2);return h.KtG(t.reupload(i))})),h._uU(13),h.ALo(14,"i18n"),h.qZA(),h._uU(15,"\n                  "),h.qZA()}if(2&e){const e=h.MAs(12),i=h.oxw().$implicit,t=h.oxw(2);h.xp6(4),h.s9C("title",h.lcZ(5,5,"attachmentFixDescription")),h.xp6(4),h.Oqu(h.lcZ(9,7,"attachmentFixDescription")),h.xp6(3),h.Q6J("appApiAction",t.reuploadPromises[i.id])("disabled",e.loading),h.xp6(2),h.hij("\n                      ",h.lcZ(14,9,"fix"),"\n                    ")}}function ki(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"td",32),h._uU(1,"\n                "),h.TgZ(2,"button",33,34),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw().$implicit,t=h.oxw(2);return h.KtG(t.delete(i))})),h.ALo(4,"i18n"),h._uU(5,"\n                  "),h._UZ(6,"i",35),h._uU(7,"\n                  "),h._UZ(8,"i",36),h.ALo(9,"i18n"),h._uU(10,"\n                "),h.qZA(),h._uU(11,"\n              "),h.qZA()}if(2&e){const e=h.MAs(3),i=h.oxw().$implicit,t=h.oxw(2);h.xp6(2),h.s9C("appA11yTitle",h.lcZ(4,6,"delete")),h.Q6J("appApiAction",t.deletePromises[i.id])("disabled",e.loading),h.xp6(4),h.Q6J("hidden",e.loading),h.xp6(2),h.s9C("title",h.lcZ(9,8,"loading")),h.Q6J("hidden",!e.loading)}}function Gi(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"tr"),h._uU(1,"\n              "),h.TgZ(2,"td",16),h._uU(3,"\n                "),h.YNc(4,Fi,1,0,"i",17),h._uU(5,"\n                "),h.YNc(6,Yi,1,0,"i",18),h._uU(7,"\n              "),h.qZA(),h._uU(8,"\n              "),h.TgZ(9,"td",19),h._uU(10,"\n                "),h.TgZ(11,"div",20),h._uU(12,"\n                  "),h.TgZ(13,"a",21),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(2);return h.KtG(t.download(i))})),h._uU(14),h.qZA(),h._uU(15,"\n                  "),h.YNc(16,Oi,16,11,"div",22),h._uU(17,"\n                "),h.qZA(),h._uU(18,"\n                "),h.TgZ(19,"small"),h._uU(20),h.qZA(),h._uU(21,"\n              "),h.qZA(),h._uU(22,"\n              "),h.YNc(23,ki,12,10,"td",23),h._uU(24,"\n            "),h.qZA()}if(2&e){const e=i.$implicit,t=h.oxw(2);h.xp6(4),h.Q6J("ngIf",!e.downloading),h.xp6(2),h.Q6J("ngIf",e.downloading),h.xp6(8),h.Oqu(e.fileName),h.xp6(2),h.Q6J("ngIf",t.showFixOldAttachments(e)),h.xp6(4),h.Oqu(e.sizeName),h.xp6(3),h.Q6J("ngIf",!t.viewOnly)}}function Ni(e,i){if(1&e&&(h.TgZ(0,"table",14),h._uU(1,"\n          "),h.TgZ(2,"tbody"),h._uU(3,"\n            "),h.YNc(4,Gi,25,6,"tr",15),h._uU(5,"\n          "),h.qZA(),h._uU(6,"\n        "),h.qZA()),2&e){const e=h.oxw();h.xp6(4),h.Q6J("ngForOf",e.cipher.attachments)}}function Di(e,i){1&e&&(h.TgZ(0,"div"),h._uU(1,"\n          "),h.TgZ(2,"h3"),h._uU(3),h.ALo(4,"i18n"),h.qZA(),h._uU(5,"\n          "),h.TgZ(6,"label",37),h._uU(7),h.ALo(8,"i18n"),h.qZA(),h._uU(9,"\n          "),h._UZ(10,"input",38),h._uU(11,"\n          "),h.TgZ(12,"small",39),h._uU(13),h.ALo(14,"i18n"),h.qZA(),h._uU(15,"\n        "),h.qZA()),2&e&&(h.xp6(3),h.Oqu(h.lcZ(4,3,"newAttachment")),h.xp6(4),h.Oqu(h.lcZ(8,5,"file")),h.xp6(6),h.Oqu(h.lcZ(14,7,"maxFileSize")))}function $i(e,i){if(1&e&&(h.TgZ(0,"button",40),h._uU(1,"\n          "),h._UZ(2,"i",41),h.ALo(3,"i18n"),h._uU(4,"\n          "),h.TgZ(5,"span"),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n        "),h.qZA()),2&e){h.oxw();const e=h.MAs(5);h.Q6J("disabled",e.loading),h.xp6(2),h.s9C("title",h.lcZ(3,3,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,5,"save"))}}class Ei extends Ti.t{constructor(e,i,t,n,o,l,r,s,c){super(e,i,t,n,o,l,r,s,c),this.viewOnly=!1}reupload(e){const i=Object.create(null,{reuploadCipherAttachment:{get:()=>super.reuploadCipherAttachment}});return Ji(this,void 0,void 0,(function*(){this.organization.canEditAnyCollection&&this.showFixOldAttachments(e)&&(yield i.reuploadCipherAttachment.call(this,e,!0))}))}loadCipher(){const e=Object.create(null,{loadCipher:{get:()=>super.loadCipher}});return Ji(this,void 0,void 0,(function*(){if(!this.organization.canEditAnyCollection)return yield e.loadCipher.call(this);const i=yield this.apiService.getCipherAdmin(this.cipherId);return new Ci.t(new xi.O(i))}))}saveCipherAttachment(e){return this.cipherService.saveAttachmentWithServer(this.cipherDomain,e,this.organization.canEditAnyCollection)}deleteCipherAttachment(e){return this.organization.canEditAnyCollection?this.apiService.deleteCipherAttachmentAdmin(this.cipherId,e):super.deleteCipherAttachment(e)}showFixOldAttachments(e){return null==e.key&&this.organization.canEditAnyCollection}}Ei.ɵfac=function(e){return new(e||Ei)(h.Y36(Xe.u),h.Y36(O.D),h.Y36(Si.$),h.Y36(Ii.b),h.Y36(G.P),h.Y36(F.s),h.Y36(N.$),h.Y36(qi._),h.Y36(D.x))},Ei.ɵcmp=h.Xpm({type:Ei,selectors:[["app-org-vault-attachments"]],features:[h.qOj],decls:42,vars:14,consts:[["role","dialog","aria-modal","true","aria-labelledby","attachmentsTitle",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-scrollable"],["ngNativeValidate","",1,"modal-content",3,"appApiAction","ngSubmit"],["form",""],[1,"modal-header"],["id","attachmentsTitle",1,"modal-title"],[4,"ngIf"],["type","button","data-dismiss","modal",1,"close",3,"appA11yTitle"],["aria-hidden","true"],[1,"modal-body"],["class","table table-hover table-list",4,"ngIf"],[1,"modal-footer"],["type","submit","class","btn btn-primary btn-submit",3,"disabled",4,"ngIf"],["type","button","data-dismiss","modal",1,"btn","btn-outline-secondary"],[1,"table","table-hover","table-list"],[4,"ngFor","ngForOf"],[1,"table-list-icon"],["class","bwi bwi-fw bwi-lg bwi-file","aria-hidden","true",4,"ngIf"],["class","bwi bwi-spinner bwi-lg bwi-fw bwi-spin","aria-hidden","true",4,"ngIf"],[1,"wrap"],[1,"d-flex"],["href","#","appStopClick","",3,"click"],["class","ml-2",4,"ngIf"],["class","table-list-options",4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-lg","bwi-file"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-lg","bwi-fw","bwi-spin"],[1,"ml-2"],["href","https://bitwarden.com/help/attachments/#fixing-old-attachments","target","_blank","rel","noopener"],["aria-hidden","true",1,"bwi","bwi-exclamation-triangle","text-warning",3,"title"],[1,"sr-only"],["type","button",1,"btn","btn-outline-primary","btn-sm","m-0","py-0","px-2",3,"appApiAction","disabled","click"],["reuploadBtn",""],[1,"table-list-options"],["type","button","appStopClick","",1,"btn","btn-outline-danger",3,"appA11yTitle","appApiAction","disabled","click"],["deleteBtn",""],["aria-hidden","true",1,"bwi","bwi-trash","bwi-lg","bwi-fw",3,"hidden"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","bwi-lg","bwi-fw",3,"hidden","title"],["for","file",1,"sr-only"],["type","file","id","file","name","file","required","",1,"form-control-file"],[1,"form-text","text-muted"],["type","submit",1,"btn","btn-primary","btn-submit",3,"disabled"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin",3,"title"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div",1),h._uU(3,"\n    "),h.TgZ(4,"form",2,3),h.NdJ("ngSubmit",(function(){return i.submit()})),h._uU(6,"\n      "),h.TgZ(7,"div",4),h._uU(8,"\n        "),h.TgZ(9,"h1",5),h._uU(10),h.ALo(11,"i18n"),h.YNc(12,Li,2,1,"small",6),h._uU(13,"\n        "),h.qZA(),h._uU(14,"\n        "),h.TgZ(15,"button",7),h.ALo(16,"i18n"),h._uU(17,"\n          "),h.TgZ(18,"span",8),h._uU(19,"×"),h.qZA(),h._uU(20,"\n        "),h.qZA(),h._uU(21,"\n      "),h.qZA(),h._uU(22,"\n      "),h.TgZ(23,"div",9),h._uU(24,"\n        "),h.YNc(25,Ni,7,1,"table",10),h._uU(26,"\n        "),h.YNc(27,Di,16,9,"div",6),h._uU(28,"\n      "),h.qZA(),h._uU(29,"\n      "),h.TgZ(30,"div",11),h._uU(31,"\n        "),h.YNc(32,$i,9,7,"button",12),h._uU(33,"\n        "),h.TgZ(34,"button",13),h._uU(35),h.ALo(36,"i18n"),h.qZA(),h._uU(37,"\n      "),h.qZA(),h._uU(38,"\n    "),h.qZA(),h._uU(39,"\n  "),h.qZA(),h._uU(40,"\n"),h.qZA(),h._uU(41,"\n")),2&e&&(h.xp6(4),h.Q6J("appApiAction",i.formPromise),h.xp6(6),h.hij("\n          ",h.lcZ(11,8,"attachments"),"\n          "),h.xp6(2),h.Q6J("ngIf",i.cipher),h.xp6(3),h.s9C("appA11yTitle",h.lcZ(16,10,"close")),h.xp6(10),h.Q6J("ngIf",i.cipher&&i.cipher.hasAttachments),h.xp6(2),h.Q6J("ngIf",!i.viewOnly),h.xp6(5),h.Q6J("ngIf",!i.viewOnly),h.xp6(3),h.hij("\n          ",h.lcZ(36,12,"close"),"\n        "))},dependencies:[E.sg,E.O5,I.JL,I.F,Q.B,zi.b,Mi.O,re.C],encapsulation:2});var Qi,Pi=t(71146),Ri=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};function Bi(e,i){if(1&e&&(h._UZ(0,"bit-access-selector",10),h.ALo(1,"i18n"),h.ALo(2,"i18n"),h.ALo(3,"i18n"),h.ALo(4,"i18n"),h.ALo(5,"async")),2&e){const e=h.oxw();h.Q6J("permissionMode",e.PermissionMode.Edit)("items",e.accessItems)("columnHeader",h.lcZ(1,7,"groupAndMemberColumnHeader"))("selectorLabelText",h.lcZ(2,9,"selectGroupsAndMembers"))("selectorHelpText",h.lcZ(3,11,"userPermissionOverrideHelper"))("emptySelectionText",h.lcZ(4,13,"noMembersOrGroupsAdded"))("flexibleCollectionsEnabled",h.lcZ(5,15,e.flexibleCollectionsEnabled$))}}function Hi(e,i){if(1&e&&(h._UZ(0,"bit-access-selector",11),h.ALo(1,"i18n"),h.ALo(2,"i18n"),h.ALo(3,"i18n"),h.ALo(4,"async")),2&e){const e=h.oxw();h.Q6J("permissionMode",e.PermissionMode.Edit)("items",e.accessItems)("columnHeader",h.lcZ(1,6,"memberColumnHeader"))("selectorLabelText",h.lcZ(2,8,"selectMembers"))("emptySelectionText",h.lcZ(3,10,"noMembersAdded"))("flexibleCollectionsEnabled",h.lcZ(4,12,e.flexibleCollectionsEnabled$))}}!function(e){e.Saved="saved",e.Canceled="canceled"}(Qi||(Qi={}));class ji{constructor(e,i,t,n,o,l,r,s,c,a){this.params=e,this.dialogRef=i,this.formBuilder=t,this.organizationService=n,this.groupService=o,this.organizationUserService=l,this.platformUtilsService=r,this.i18nService=s,this.collectionAdminService=c,this.configService=a,this.flexibleCollectionsEnabled$=this.configService.getFeatureFlag$(M.T.FlexibleCollections,!1),this.PermissionMode=L.R9,this.formGroup=this.formBuilder.group({access:[[]]}),this.loading=!0,this.accessItems=[],this.destroy$=new p.x,this.submit=()=>Ri(this,void 0,void 0,(function*(){const e=this.formGroup.controls.access.value.filter((e=>e.type===L.zD.Member)).map(L.E2),i=this.formGroup.controls.access.value.filter((e=>e.type===L.zD.Group)).map(L.E2);yield this.collectionAdminService.bulkAssignAccess(this.organization.id,this.params.collections.map((e=>e.id)),e,i),this.platformUtilsService.showToast("success",null,this.i18nService.t("editedCollections")),this.dialogRef.close(Qi.Saved)})),this.numCollections=this.params.collections.length;const u=this.organizationService.get$(this.params.organizationId),d=u.pipe((0,m.w)((e=>e.useGroups?this.groupService.getAll(e.id):(0,q.of)([]))));(0,v.a)([u,d,this.organizationUserService.getAllUsers(this.params.organizationId)]).pipe((0,_.R)(this.destroy$)).subscribe((([e,i,t])=>{this.organization=e,this.accessItems=[].concat(i.map(L.hs),t.data.map(L.XL)),this.loading=!1}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static open(e,i){return e.open(ji,i)}}ji.ɵfac=function(e){return new(e||ji)(h.Y36(S.Kt),h.Y36(S.zj),h.Y36(I.qu),h.Y36(c.Mn),h.Y36(l.lT),h.Y36(Y.t),h.Y36(G.P),h.Y36(O.D),h.Y36(Ke.m),h.Y36($.i))},ji.ɵcmp=h.Xpm({type:ji,selectors:[["app-bulk-collections-dialog"]],standalone:!0,features:[h.jDz],decls:32,vars:18,consts:[[3,"formGroup","bitSubmit"],["dialogSize","large",3,"loading"],["bitDialogTitle",""],[1,"tw-text-sm","tw-normal-case","tw-text-muted"],["bitDialogContent",""],["formControlName","access",3,"permissionMode","items","columnHeader","selectorLabelText","selectorHelpText","emptySelectionText","flexibleCollectionsEnabled",4,"ngIf"],["formControlName","access",3,"permissionMode","items","columnHeader","selectorLabelText","emptySelectionText","flexibleCollectionsEnabled",4,"ngIf"],["bitDialogFooter",""],["type","submit","bitButton","","bitFormButton","","buttonType","primary"],["type","button","bitButton","","bitFormButton","","buttonType","secondary","bitDialogClose",""],["formControlName","access",3,"permissionMode","items","columnHeader","selectorLabelText","selectorHelpText","emptySelectionText","flexibleCollectionsEnabled"],["formControlName","access",3,"permissionMode","items","columnHeader","selectorLabelText","emptySelectionText","flexibleCollectionsEnabled"]],template:function(e,i){1&e&&(h.TgZ(0,"form",0),h._uU(1,"\n  "),h.TgZ(2,"bit-dialog",1),h._uU(3,"\n    "),h.TgZ(4,"span",2),h._uU(5),h.ALo(6,"i18n"),h.TgZ(7,"span",3),h._uU(8),h.ALo(9,"i18n"),h.qZA(),h._uU(10,"\n    "),h.qZA(),h._uU(11,"\n\n    "),h.TgZ(12,"div",4),h._uU(13,"\n      "),h.YNc(14,Bi,6,17,"bit-access-selector",5),h._uU(15,"\n      "),h.YNc(16,Hi,5,14,"bit-access-selector",6),h._uU(17,"\n    "),h.qZA(),h._uU(18,"\n\n    "),h.ynx(19,7),h._uU(20,"\n      "),h.TgZ(21,"button",8),h._uU(22),h.ALo(23,"i18n"),h.qZA(),h._uU(24,"\n      "),h.TgZ(25,"button",9),h._uU(26),h.ALo(27,"i18n"),h.qZA(),h._uU(28,"\n    "),h.BQk(),h._uU(29,"\n  "),h.qZA(),h._uU(30,"\n"),h.qZA(),h._uU(31,"\n")),2&e&&(h.Q6J("formGroup",i.formGroup)("bitSubmit",i.submit),h.xp6(2),h.Q6J("loading",i.loading),h.xp6(3),h.hij("\n      ",h.lcZ(6,10,"assignCollectionAccess"),"\n      "),h.xp6(3),h.AsE("\n        ",i.numCollections," ",h.lcZ(9,12,1==i.numCollections?"collection":"collections"),"\n      "),h.xp6(6),h.Q6J("ngIf",null==i.organization?null:i.organization.useGroups),h.xp6(2),h.Q6J("ngIf",!(null!=i.organization&&i.organization.useGroups)),h.xp6(6),h.hij("\n        ",h.lcZ(23,14,"save"),"\n      "),h.xp6(4),h.hij("\n        ",h.lcZ(27,16,"cancel"),"\n      "))},dependencies:[Pi.m,E.O5,I._Y,I.JJ,I.JL,I.sg,I.u,B.b,H.u,j.r,K.a,W.f,E.Ov,re.C,L.k4,le.f],encapsulation:2});var Ki=t(43898),Wi=t(17475),Vi=t(12963),Xi=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};function et(e,i){if(1&e&&(h.TgZ(0,"small"),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(1),h.Oqu(e.cipher.name)}}function it(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div",17),h._uU(1,"\n            "),h.TgZ(2,"button",18),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw();return h.KtG(i.selectAll(!0))})),h._uU(3),h.ALo(4,"i18n"),h.qZA(),h._uU(5,"\n            "),h.TgZ(6,"button",18),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw();return h.KtG(i.selectAll(!1))})),h._uU(7),h.ALo(8,"i18n"),h.qZA(),h._uU(9,"\n          "),h.qZA()}2&e&&(h.xp6(3),h.hij("\n              ",h.lcZ(4,2,"selectAll"),"\n            "),h.xp6(4),h.hij("\n              ",h.lcZ(8,4,"unselectAll"),"\n            "))}function tt(e,i){1&e&&(h.TgZ(0,"div"),h._uU(1),h.ALo(2,"i18n"),h.qZA()),2&e&&(h.xp6(1),h.hij("\n          ",h.lcZ(2,1,"noCollectionsInList"),"\n        "))}function nt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"tr",21),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(2);return h.KtG(t.check(i))})),h._uU(1,"\n              "),h.TgZ(2,"td",22),h._uU(3,"\n                "),h.TgZ(4,"input",23),h.NdJ("ngModelChange",(function(i){const t=h.CHM(e).$implicit;return h.KtG(t.checked=i)})),h.qZA(),h._uU(5,"\n              "),h.qZA(),h._uU(6,"\n              "),h.TgZ(7,"td"),h._uU(8),h.qZA(),h._uU(9,"\n            "),h.qZA()}if(2&e){const e=i.$implicit,t=i.index;h.xp6(4),h.MGl("name","Collection[",t,"].Checked"),h.Q6J("ngModel",e.checked),h.xp6(4),h.hij("\n                ",e.name,"\n              ")}}function ot(e,i){if(1&e&&(h.TgZ(0,"table",19),h._uU(1,"\n          "),h.TgZ(2,"tbody"),h._uU(3,"\n            "),h.YNc(4,nt,10,3,"tr",20),h._uU(5,"\n          "),h.qZA(),h._uU(6,"\n        "),h.qZA()),2&e){const e=h.oxw();h.xp6(4),h.Q6J("ngForOf",e.collections)}}class lt extends Wi.U{constructor(e,i,t,n,o,l){super(e,i,t,n,l),this.apiService=o,this.allowSelectNone=!0}loadCipher(){const e=Object.create(null,{loadCipher:{get:()=>super.loadCipher}});return Xi(this,void 0,void 0,(function*(){if(!this.organization.canViewAllCollections)return yield e.loadCipher.call(this);const i=yield this.apiService.getCipherAdmin(this.cipherId);return new Ci.t(new xi.O(i))}))}loadCipherCollections(){return this.organization.canViewAllCollections?this.collectionIds:super.loadCipherCollections()}loadCollections(){return this.organization.canViewAllCollections?Promise.resolve(this.collections):super.loadCollections()}saveCollections(){if(this.organization.canEditAnyCollection){const e=new Ki.L(this.cipherDomain.collectionIds);return this.apiService.putCipherCollectionsAdmin(this.cipherId,e)}return super.saveCollections()}}lt.ɵfac=function(e){return new(e||lt)(h.Y36(k.a),h.Y36(G.P),h.Y36(O.D),h.Y36(Xe.u),h.Y36(F.s),h.Y36(N.$))},lt.ɵcmp=h.Xpm({type:lt,selectors:[["app-org-vault-collections"]],features:[h.qOj],decls:63,vars:27,consts:[["role","dialog","aria-modal","true","aria-labelledby","collectionsTitle",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-scrollable"],[1,"modal-content",3,"appApiAction","ngSubmit"],["form",""],[1,"modal-header"],["id","collectionsTitle",1,"modal-title"],[4,"ngIf"],["type","button","data-dismiss","modal",1,"close",3,"appA11yTitle"],["aria-hidden","true"],[1,"modal-body"],[1,"d-flex"],["class","ml-auto d-flex",4,"ngIf"],["class","table table-hover table-list mb-0",4,"ngIf"],[1,"modal-footer"],["type","submit",1,"btn","btn-primary","btn-submit",3,"disabled"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin",3,"title"],["type","button","data-dismiss","modal",1,"btn","btn-outline-secondary"],[1,"ml-auto","d-flex"],["type","button",1,"btn","btn-link","btn-sm","py-0",3,"click"],[1,"table","table-hover","table-list","mb-0"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"table-list-checkbox"],["type","checkbox","appStopProp","",3,"ngModel","name","ngModelChange"]],template:function(e,i){if(1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div",1),h._uU(3,"\n    "),h.TgZ(4,"form",2,3),h.NdJ("ngSubmit",(function(){return i.submit()})),h._uU(6,"\n      "),h.TgZ(7,"div",4),h._uU(8,"\n        "),h.TgZ(9,"h1",5),h._uU(10),h.ALo(11,"i18n"),h.YNc(12,et,2,1,"small",6),h._uU(13,"\n        "),h.qZA(),h._uU(14,"\n        "),h.TgZ(15,"button",7),h.ALo(16,"i18n"),h._uU(17,"\n          "),h.TgZ(18,"span",8),h._uU(19,"×"),h.qZA(),h._uU(20,"\n        "),h.qZA(),h._uU(21,"\n      "),h.qZA(),h._uU(22,"\n      "),h.TgZ(23,"div",9),h._uU(24,"\n        "),h.TgZ(25,"p"),h._uU(26),h.ALo(27,"i18n"),h.qZA(),h._uU(28,"\n        "),h.TgZ(29,"div",10),h._uU(30,"\n          "),h.TgZ(31,"h3"),h._uU(32),h.ALo(33,"i18n"),h.qZA(),h._uU(34,"\n          "),h.YNc(35,it,10,6,"div",11),h._uU(36,"\n        "),h.qZA(),h._uU(37,"\n        "),h.YNc(38,tt,3,3,"div",6),h._uU(39,"\n        "),h.YNc(40,ot,7,1,"table",12),h._uU(41,"\n      "),h.qZA(),h._uU(42,"\n      "),h.TgZ(43,"div",13),h._uU(44,"\n        "),h.TgZ(45,"button",14),h._uU(46,"\n          "),h._UZ(47,"i",15),h.ALo(48,"i18n"),h._uU(49,"\n          "),h.TgZ(50,"span"),h._uU(51),h.ALo(52,"i18n"),h.qZA(),h._uU(53,"\n        "),h.qZA(),h._uU(54,"\n        "),h.TgZ(55,"button",16),h._uU(56),h.ALo(57,"i18n"),h.qZA(),h._uU(58,"\n      "),h.qZA(),h._uU(59,"\n    "),h.qZA(),h._uU(60,"\n  "),h.qZA(),h._uU(61,"\n"),h.qZA(),h._uU(62,"\n")),2&e){const e=h.MAs(5);h.xp6(4),h.Q6J("appApiAction",i.formPromise),h.xp6(6),h.hij("\n          ",h.lcZ(11,13,"collections"),"\n          "),h.xp6(2),h.Q6J("ngIf",i.cipher),h.xp6(3),h.s9C("appA11yTitle",h.lcZ(16,15,"close")),h.xp6(11),h.Oqu(h.lcZ(27,17,"collectionsDesc")),h.xp6(6),h.Oqu(h.lcZ(33,19,"collections")),h.xp6(3),h.Q6J("ngIf",i.collections&&i.collections.length),h.xp6(3),h.Q6J("ngIf",!i.collections||!i.collections.length),h.xp6(2),h.Q6J("ngIf",i.collections&&i.collections.length),h.xp6(5),h.Q6J("disabled",e.loading),h.xp6(2),h.s9C("title",h.lcZ(48,21,"loading")),h.xp6(4),h.Oqu(h.lcZ(52,23,"save")),h.xp6(5),h.hij("\n          ",h.lcZ(57,25,"cancel"),"\n        ")}},dependencies:[E.sg,E.O5,I._Y,I.Wl,I.JJ,I.JL,I.On,I.F,Q.B,zi.b,Vi._,re.C],encapsulation:2});t(27263);var rt=t(30276),st=t(26187),ct=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};function at(e,i){1&e&&(h.TgZ(0,"div",3),h._uU(1,"\n    "),h._UZ(2,"i",4),h._uU(3,"\n  "),h.qZA())}function ut(e,i){if(1&e&&(h.ynx(0),h._uU(1,"\n        "),h.TgZ(2,"div",11),h._uU(3,"\n          "),h.TgZ(4,"app-filter-section",12),h._uU(5," "),h.qZA(),h._uU(6,"\n        "),h.qZA(),h._uU(7,"\n      "),h.BQk()),2&e){const e=i.$implicit,t=h.oxw(2);h.xp6(4),h.Q6J("activeFilter",t.activeFilter)("section",e)}}function dt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div"),h._uU(1,"\n    "),h.TgZ(2,"div",5),h._uU(3),h.ALo(4,"i18n"),h.TgZ(5,"a",6),h.ALo(6,"i18n"),h._uU(7,"\n        "),h._UZ(8,"i",7),h._uU(9,"\n      "),h.qZA(),h._uU(10,"\n    "),h.qZA(),h._uU(11,"\n    "),h.TgZ(12,"div",8),h._uU(13,"\n      "),h.TgZ(14,"input",9),h.NdJ("ngModelChange",(function(i){h.CHM(e);const t=h.oxw();return h.KtG(t.onSearchTextChanged(i))})),h.ALo(15,"i18n"),h.qZA(),h._uU(16,"\n      "),h.YNc(17,ut,8,2,"ng-container",10),h._uU(18,"\n    "),h.qZA(),h._uU(19,"\n  "),h.qZA()}if(2&e){const e=h.oxw();h.xp6(3),h.hij("\n      ",h.lcZ(4,5,"filters"),"\n      "),h.xp6(2),h.s9C("appA11yTitle",h.lcZ(6,7,"learnMore")),h.xp6(9),h.s9C("placeholder",h.lcZ(15,9,e.searchPlaceholder)),h.Q6J("ngModel",e.searchText),h.xp6(3),h.Q6J("ngForOf",e.filtersList)}}class ht extends rt.P{set organization(e){e&&e!==this._organization&&(this._organization=e,this.vaultFilterService.setOrganizationFilter(this._organization))}ngOnInit(){return ct(this,void 0,void 0,(function*(){this.filters=yield this.buildAllFilters(),this.activeFilter.selectedCipherTypeNode||(this.activeFilter.resetFilter(),this.activeFilter.selectedCollectionNode=yield this.getDefaultFilter()),this.isLoaded=!0}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}buildAllFilters(){return ct(this,void 0,void 0,(function*(){const e={};return e.typeFilter=yield this.addTypeFilter(["favorites"]),e.collectionFilter=yield this.addCollectionFilter(),e.trashFilter=yield this.addTrashFilter(),e}))}getDefaultFilter(){var e;return ct(this,void 0,void 0,(function*(){return yield(0,oi.z)(null===(e=this.filters)||void 0===e?void 0:e.collectionFilter.data$)}))}}ht.ɵfac=function(){let e;return function(i){return(e||(e=h.n5z(ht)))(i||ht)}}(),ht.ɵcmp=h.Xpm({type:ht,selectors:[["app-organization-vault-filter"]],inputs:{organization:"organization"},features:[h.qOj],decls:7,vars:2,consts:[[1,"card","vault-filters"],["class","container loading-spinner",4,"ngIf"],[4,"ngIf"],[1,"container","loading-spinner"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","bwi-3x"],[1,"card-header","d-flex"],["href","https://bitwarden.com/help/searching-vault/","target","_blank","rel","noopener",1,"ml-auto",3,"appA11yTitle"],["aria-hidden","true",1,"bwi","bwi-question-circle"],[1,"card-body"],["type","search","id","search","autocomplete","off","appAutofocus","",1,"form-control",3,"placeholder","ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[1,"filter"],[3,"activeFilter","section"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.YNc(2,at,4,0,"div",1),h._uU(3,"\n  "),h.YNc(4,dt,20,11,"div",2),h._uU(5,"\n"),h.qZA(),h._uU(6,"\n")),2&e&&(h.xp6(2),h.Q6J("ngIf",!i.isLoaded),h.xp6(2),h.Q6J("ngIf",i.isLoaded))},dependencies:[E.sg,E.O5,I.Fj,I.JJ,I.On,Q.B,P.U,st.n,re.C],encapsulation:2});var pt=t(4871),gt=t(34961),ft=t(7323),mt=t(87483),vt=t(27191),bt=t(53707),Ut=t(22221),Zt=t(98583),_t=t(8427),wt=t(93814),At=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};const yt=function(){return[]},xt=function(e){return{collectionId:e}};function Ct(e,i){if(1&e&&(h.TgZ(0,"bit-breadcrumb",7),h._uU(1),h.qZA()),2&e){const e=i.$implicit;h.Q6J("route",h.DdM(3,yt))("queryParams",h.VKq(4,xt,e.id)),h.xp6(1),h.hij("\n          ",e.name,"\n        ")}}const Tt=function(e){return{organizationId:e,collectionId:null}};function St(e,i){if(1&e&&(h.TgZ(0,"bit-breadcrumbs"),h._uU(1,"\n      "),h.TgZ(2,"bit-breadcrumb",5),h._uU(3),h.ALo(4,"lowercase"),h.ALo(5,"i18n"),h.qZA(),h._uU(6,"\n      "),h.ynx(7),h._uU(8,"\n        "),h.YNc(9,Ct,2,6,"bit-breadcrumb",6),h._uU(10,"\n      "),h.BQk(),h._uU(11,"\n    "),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("route",h.DdM(9,yt))("queryParams",h.VKq(10,Tt,e.organization.id)),h.xp6(1),h.AsE("\n        ",e.organization.name," ",h.lcZ(4,5,h.lcZ(5,7,"vault")),"\n      "),h.xp6(6),h.Q6J("ngForOf",e.collections)}}function It(e,i){1&e&&h._UZ(0,"i",8)}function qt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.editCollection(i.CollectionDialogTabType.Info))})),h._uU(1,"\n            "),h._UZ(2,"i",13),h._uU(3),h.ALo(4,"i18n"),h.qZA()}2&e&&(h.xp6(3),h.hij("\n            ",h.lcZ(4,1,"editInfo"),"\n          "))}function zt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.editCollection(i.CollectionDialogTabType.Access))})),h._uU(1,"\n            "),h._UZ(2,"i",14),h._uU(3),h.ALo(4,"i18n"),h.qZA()}2&e&&(h.xp6(3),h.hij("\n            ",h.lcZ(4,1,"access"),"\n          "))}function Mt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.deleteCollection())})),h._uU(1,"\n            "),h.TgZ(2,"span",15),h._uU(3,"\n              "),h._UZ(4,"i",16),h._uU(5),h.ALo(6,"i18n"),h.qZA(),h._uU(7,"\n          "),h.qZA()}2&e&&(h.xp6(5),h.hij("\n              ",h.lcZ(6,1,"delete"),"\n            "))}function Jt(e,i){if(1&e&&(h.ynx(0),h._uU(1,"\n        "),h._UZ(2,"button",9),h._uU(3,"\n        "),h.TgZ(4,"bit-menu",null,10),h._uU(6,"\n          "),h.YNc(7,qt,5,3,"button",11),h._uU(8,"\n          "),h.YNc(9,zt,5,3,"button",11),h._uU(10,"\n          "),h.YNc(11,Mt,8,3,"button",11),h._uU(12,"\n        "),h.qZA(),h._uU(13,"\n      "),h.BQk()),2&e){const e=h.MAs(5),i=h.oxw();h.xp6(2),h.Q6J("bitMenuTriggerFor",e),h.xp6(5),h.Q6J("ngIf",i.canEditCollection),h.xp6(2),h.Q6J("ngIf",i.canEditCollection),h.xp6(2),h.Q6J("ngIf",i.canDeleteCollection)}}function Lt(e,i){1&e&&(h.TgZ(0,"small"),h._uU(1,"\n        "),h._UZ(2,"i",17),h.ALo(3,"i18n"),h._uU(4,"\n        "),h.TgZ(5,"span",18),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n      "),h.qZA()),2&e&&(h.xp6(2),h.s9C("title",h.lcZ(3,2,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,4,"loading")))}function Ft(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div",22),h._uU(1,"\n      "),h.TgZ(2,"button",23),h.ALo(3,"i18n"),h._uU(4),h.ALo(5,"i18n"),h._UZ(6,"i",24),h._uU(7,"\n      "),h.qZA(),h._uU(8,"\n      "),h.TgZ(9,"bit-menu",25,26),h._uU(11,"\n        "),h.TgZ(12,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.addCipher())})),h._uU(13,"\n          "),h._UZ(14,"i",27),h._uU(15),h.ALo(16,"i18n"),h.qZA(),h._uU(17,"\n        "),h.TgZ(18,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.addCollection())})),h._uU(19,"\n          "),h._UZ(20,"i",28),h._uU(21),h.ALo(22,"i18n"),h.qZA(),h._uU(23,"\n      "),h.qZA(),h._uU(24,"\n    "),h.qZA()}if(2&e){const e=h.MAs(10);h.xp6(2),h.s9C("appA11yTitle",h.lcZ(3,5,"new")),h.Q6J("bitMenuTriggerFor",e),h.xp6(2),h.hij("\n        ",h.lcZ(5,7,"new"),""),h.xp6(11),h.hij("\n          ",h.lcZ(16,9,"item"),"\n        "),h.xp6(6),h.hij("\n          ",h.lcZ(22,11,"collection"),"\n        ")}}function Yt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",29),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.addCipher())})),h._uU(1,"\n      "),h._UZ(2,"i",30),h._uU(3),h.ALo(4,"i18n"),h.qZA()}2&e&&(h.xp6(3),h.hij("\n      ",h.lcZ(4,1,"newItem"),"\n    "))}function Ot(e,i){if(1&e&&(h.TgZ(0,"div",19),h._uU(1,"\n    "),h.YNc(2,Ft,25,13,"div",20),h._uU(3,"\n    "),h.YNc(4,Yt,5,3,"button",21),h._uU(5,"\n  "),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("ngIf",e.organization.canCreateNewCollections),h.xp6(2),h.Q6J("ngIf",!e.organization.canCreateNewCollections)}}class kt{constructor(e,i,t,n,o,l){this.organizationService=e,this.i18nService=i,this.dialogService=t,this.collectionAdminService=n,this.router=o,this.configService=l,this.All=wi.oT,this.Unassigned=wi.JK,this.onAddCipher=new h.vpe,this.onAddCollection=new h.vpe,this.onEditCollection=new h.vpe,this.onDeleteCollection=new h.vpe,this.CollectionDialogTabType=$e.sn,this.organizations$=this.organizationService.organizations$}ngOnInit(){return At(this,void 0,void 0,(function*(){this.flexibleCollectionsEnabled=yield this.configService.getFeatureFlag(M.T.FlexibleCollections)}))}get title(){return void 0!==this.collection?this.collection.node.name:this.filter.collectionId===wi.JK?this.i18nService.t("unassigned"):`${this.organization.name} ${this.i18nService.t("vault").toLowerCase()}`}get showBreadcrumbs(){return void 0!==this.filter.collectionId&&this.filter.collectionId!==wi.oT}get collections(){if(null==this.collection)return[];const e=[this.collection];for(;null!=e[e.length-1].parent;)e.push(e[e.length-1].parent);return e.slice(1).reverse().map((e=>e.node))}showFreeOrgUpgradeDialog(){const e={title:this.i18nService.t("upgradeOrganization"),content:this.i18nService.t(this.organization.canEditSubscription?"freeOrgMaxCollectionReachedManageBilling":"freeOrgMaxCollectionReachedNoManageBilling",this.organization.maxCollections),type:"primary"};this.organization.canEditSubscription?e.acceptButtonText=this.i18nService.t("upgrade"):(e.acceptButtonText=this.i18nService.t("ok"),e.cancelButtonText=null);const i=this.dialogService.openSimpleDialogRef(e);(0,oi.z)(i.closed).then((e=>{e&&e&&this.organization.canEditSubscription&&this.router.navigate(["/organizations",this.organization.id,"billing","subscription"],{queryParams:{upgrade:!0}})}))}get canEditCollection(){return void 0!==this.collection&&this.collection.node.canEdit(this.organization)}addCipher(){this.onAddCipher.emit()}addCollection(){return At(this,void 0,void 0,(function*(){if(this.organization.planProductType===ui.kv.Free){if((yield this.collectionAdminService.getAll(this.organization.id)).length===this.organization.maxCollections)return void this.showFreeOrgUpgradeDialog()}this.onAddCollection.emit()}))}editCollection(e){return At(this,void 0,void 0,(function*(){this.onEditCollection.emit({tab:e})}))}get canDeleteCollection(){return void 0!==this.collection&&this.collection.node.canDelete(this.organization,this.flexibleCollectionsEnabled)}deleteCollection(){this.onDeleteCollection.emit()}}kt.ɵfac=function(e){return new(e||kt)(h.Y36(c.Mn),h.Y36(O.D),h.Y36(D.x),h.Y36(Ke.m),h.Y36(r.F0),h.Y36($.i))},kt.ɵcmp=h.Xpm({type:kt,selectors:[["app-org-vault-header"]],inputs:{loading:"loading",filter:"filter",organization:"organization",collection:"collection"},outputs:{onAddCipher:"onAddCipher",onAddCollection:"onAddCollection",onEditCollection:"onEditCollection",onDeleteCollection:"onDeleteCollection"},decls:22,vars:6,consts:[[1,"tw-mb-4","tw-flex","tw-items-start","tw-justify-between"],[4,"ngIf"],[1,"tw-mb-0","tw-mt-1","tw-flex","tw-items-center","tw-space-x-2"],["class","bwi bwi-collection","aria-hidden","true",4,"ngIf"],["class","tw-shrink-0",4,"ngIf"],["queryParamsHandling","merge",3,"route","queryParams"],["icon","bwi-collection","queryParamsHandling","merge",3,"route","queryParams",4,"ngFor","ngForOf"],["icon","bwi-collection","queryParamsHandling","merge",3,"route","queryParams"],["aria-hidden","true",1,"bwi","bwi-collection"],["bitIconButton","bwi-angle-down","size","small","type","button","aria-haspopup","",3,"bitMenuTriggerFor"],["editCollectionMenu",""],["type","button","bitMenuItem","",3,"click",4,"ngIf"],["type","button","bitMenuItem","",3,"click"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-pencil-square"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-users"],[1,"tw-text-danger"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-trash"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","text-muted",3,"title"],[1,"tw-sr-only"],[1,"tw-shrink-0"],["appListDropdown","",4,"ngIf"],["type","button","bitButton","","buttonType","primary",3,"click",4,"ngIf"],["appListDropdown",""],["bitButton","","buttonType","primary","type","button","id","newItemDropdown",3,"bitMenuTriggerFor","appA11yTitle"],["aria-hidden","true",1,"bwi","bwi-angle-down","tw-ml-2"],["aria-labelledby","newItemDropdown"],["addOptions",""],["aria-hidden","true",1,"bwi","bwi-fw","bwi-globe"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-collection"],["type","button","bitButton","","buttonType","primary",3,"click"],["aria-hidden","true",1,"bwi","bwi-plus","bwi-fw"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div"),h._uU(3,"\n    "),h.YNc(4,St,12,12,"bit-breadcrumbs",1),h._uU(5,"\n    "),h.TgZ(6,"h1",2),h._uU(7,"\n      "),h.YNc(8,It,1,0,"i",3),h._uU(9,"\n      "),h.TgZ(10,"span"),h._uU(11),h.qZA(),h._uU(12,"\n      "),h.YNc(13,Jt,14,4,"ng-container",1),h._uU(14,"\n      "),h.YNc(15,Lt,9,6,"small",1),h._uU(16,"\n    "),h.qZA(),h._uU(17,"\n  "),h.qZA(),h._uU(18,"\n\n  "),h.YNc(19,Ot,6,2,"div",4),h._uU(20,"\n"),h.qZA(),h._uU(21,"\n")),2&e&&(h.xp6(4),h.Q6J("ngIf",i.showBreadcrumbs),h.xp6(4),h.Q6J("ngIf",void 0!==i.filter.collectionId),h.xp6(3),h.Oqu(i.title),h.xp6(2),h.Q6J("ngIf",void 0!==i.collection&&(i.canEditCollection||i.canDeleteCollection)),h.xp6(2),h.Q6J("ngIf",i.loading),h.xp6(4),h.Q6J("ngIf","trash"!==i.filter.type&&i.filter.collectionId!==i.Unassigned))},dependencies:[E.sg,E.O5,Q.B,j.r,te.Q,be.M,Ue.t,Ze.e,_t.n,wt.L,E.i8,re.C],encapsulation:2});var Gt=function(e,i,t,n){return new(t||(t=Promise))((function(o,l){function r(e){try{c(n.next(e))}catch(i){l(i)}}function s(e){try{c(n.throw(e))}catch(i){l(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,s)}c((n=n.apply(e,i||[])).next())}))};const Nt=["vaultFilter"],Dt=["attachments"],$t=["cipherAddEdit"],Et=["collectionsModal"];function Qt(e,i){if(1&e&&(h.TgZ(0,"app-callout",16),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(1),h.hij("\n        ",e.trashCleanupWarning,"\n      ")}}function Pt(e,i){if(1&e&&(h.TgZ(0,"div",17),h._uU(1,"\n        "),h._UZ(2,"bit-icon",18),h._uU(3,"\n        "),h.TgZ(4,"p"),h._uU(5),h.ALo(6,"i18n"),h.qZA(),h._uU(7,"\n      "),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("icon",e.noItemIcon),h.xp6(3),h.Oqu(h.lcZ(6,2,"noPermissionToViewAllCollectionItems"))}}function Rt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",20),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.addCipher())})),h._uU(1,"\n          "),h._UZ(2,"i",21),h._uU(3),h.ALo(4,"i18n"),h.qZA()}2&e&&(h.xp6(3),h.hij("\n          ",h.lcZ(4,1,"newItem"),"\n        "))}function Bt(e,i){if(1&e&&(h.TgZ(0,"div",17),h._uU(1,"\n        "),h._UZ(2,"bit-icon",18),h._uU(3,"\n        "),h.TgZ(4,"p"),h._uU(5),h.ALo(6,"i18n"),h.qZA(),h._uU(7,"\n        "),h.YNc(8,Rt,5,3,"button",19),h._uU(9,"\n      "),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("icon",e.noItemIcon),h.xp6(3),h.Oqu(h.lcZ(6,3,"noItemsInList")),h.xp6(3),h.Q6J("ngIf","trash"!==e.filter.type&&e.filter.collectionId!==e.Unassigned)}}function Ht(e,i){1&e&&(h.TgZ(0,"div",17),h._uU(1,"\n        "),h._UZ(2,"i",22),h.ALo(3,"i18n"),h._uU(4,"\n        "),h.TgZ(5,"span",23),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n      "),h.qZA()),2&e&&(h.xp6(2),h.s9C("title",h.lcZ(3,2,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,4,"loading")))}function jt(e,i){}function Kt(e,i){}function Wt(e,i){}const Vt=function(e){return[e]},Xt=function(){return[]},en="OrgVaultComponent";class tn{constructor(e,i,t,n,o,l,r,s,c,a,u,d,h,f,m,v,b,U,Z,_,w,A,y,x,C,T){this.route=e,this.organizationService=i,this.vaultFilterService=t,this.routedVaultFilterBridgeService=n,this.routedVaultFilterService=o,this.router=l,this.changeDetectorRef=r,this.syncService=s,this.i18nService=c,this.modalService=a,this.dialogService=u,this.messagingService=d,this.broadcasterService=h,this.ngZone=f,this.platformUtilsService=m,this.cipherService=v,this.passwordRepromptService=b,this.collectionAdminService=U,this.searchService=Z,this.searchPipe=_,this.groupService=w,this.logService=A,this.eventCollectionService=y,this.totpService=x,this.apiService=C,this.configService=T,this.Unassigned=wi.JK,this.trashCleanupWarning=null,this.activeFilter=new mi.l,this.noItemIcon=pi.o,this.performingInitialLoad=!0,this.refreshing=!1,this.processingEvent=!1,this.filter={},this.showBulkEditCollectionAccess$=this.configService.getFeatureFlag$(M.T.BulkCollectionAccess,!1),this.searchText$=new p.x,this.refresh$=new g.X(null),this.destroy$=new p.x}ngOnInit(){return Gt(this,void 0,void 0,(function*(){this.trashCleanupWarning=this.i18nService.t(this.platformUtilsService.isSelfHost()?"trashCleanupWarningSelfHosted":"trashCleanupWarning");const e=this.routedVaultFilterService.filter$,i=e.pipe((0,Z.U)((e=>e.organizationId)),(0,li.h)((e=>void 0!==e)),(0,ri.x)()),t=i.pipe((0,m.w)((e=>this.organizationService.get$(e))),(0,_.R)(this.destroy$),(0,si.d)({refCount:!1,bufferSize:1})),n=(0,v.a)([t,this.route.queryParams]).pipe((0,A.P)(),(0,m.w)((([e])=>Gt(this,void 0,void 0,(function*(){this.organization=e,e.canUseAdminCollections||(yield this.syncService.fullSync(!1))})))),(0,si.d)({refCount:!0,bufferSize:1}));this.broadcasterService.subscribe(en,(e=>{this.ngZone.run((()=>Gt(this,void 0,void 0,(function*(){if("syncCompleted"===e.command)e.successfully&&(this.refresh(),this.changeDetectorRef.detectChanges())}))))})),this.routedVaultFilterBridgeService.activeFilter$.pipe((0,_.R)(this.destroy$)).subscribe((e=>{this.activeFilter=e})),this.searchText$.pipe((0,ci.b)(200),(0,_.R)(this.destroy$)).subscribe((e=>this.router.navigate([],{queryParams:{search:x.c.isNullOrEmpty(e)?null:e},queryParamsHandling:"merge",replaceUrl:!0}))),this.currentSearchText$=this.route.queryParams.pipe((0,Z.U)((e=>e.search)));const o=i.pipe((0,m.w)((e=>this.collectionAdminService.getAll(e))),(0,si.d)({refCount:!0,bufferSize:1})),l=(0,v.a)([i,o]).pipe((0,Z.U)((([e,i])=>{const t=new vi.e;return t.name=this.i18nService.t("unassigned"),t.id=wi.JK,t.organizationId=e,i.concat(t)}))),r=i.pipe((0,m.w)((e=>this.groupService.getAll(e))),(0,si.d)({refCount:!0,bufferSize:1})),s=t.pipe((0,U.b)((e=>Gt(this,void 0,void 0,(function*(){let i;return i=e.canEditAnyCollection?yield this.cipherService.getAllFromApiForOrganization(e.id):(yield this.cipherService.getAllDecrypted()).filter((i=>i.organizationId===e.id)),yield this.searchService.indexCiphers(i,e.id),i}))))),c=(0,v.a)([s,e,this.currentSearchText$]).pipe((0,li.h)((([e,i])=>null!=e&&null!=i)),(0,U.b)((([e,i,t])=>Gt(this,void 0,void 0,(function*(){if(void 0===i.collectionId&&void 0===i.type)return[];const n=(0,_i.E)(i);return this.searchService.isSearchable(t)?yield this.searchService.searchCiphers(t,[n],e):e.filter(n)})))),(0,si.d)({refCount:!0,bufferSize:1})),a=l.pipe((0,Z.U)((e=>(0,Ai.o)(e))),(0,si.d)({refCount:!0,bufferSize:1})),u=(0,v.a)([a,e,this.currentSearchText$]).pipe((0,li.h)((([e,i])=>null!=e&&null!=i)),(0,Z.U)((([e,i,t])=>{var n;if(i.collectionId===wi.JK||void 0===i.collectionId&&void 0!==i.type)return[];let o=[];if(void 0===i.collectionId||i.collectionId===wi.oT)o=e.map((e=>e.node));else{const t=di.L.getTreeNodeObjectFromList(e,i.collectionId);o=null!==(n=null==t?void 0:t.children.map((e=>e.node)))&&void 0!==n?n:[]}return this.searchService.isSearchable(t)&&(o=this.searchPipe.transform(o,t,(e=>e.name),(e=>e.id))),o})),(0,_.R)(this.destroy$),(0,si.d)({refCount:!0,bufferSize:1})),d=(0,v.a)([a,e]).pipe((0,li.h)((([e,i])=>null!=e&&null!=i)),(0,Z.U)((([e,i])=>{if(void 0!==i.collectionId&&i.collectionId!==wi.oT&&i.collectionId!==wi.JK)return di.L.getTreeNodeObjectFromList(e,i.collectionId)})),(0,si.d)({refCount:!0,bufferSize:1})),h=(0,v.a)([e,d,t]).pipe((0,Z.U)((([e,i,t])=>e.collectionId===wi.JK&&!t.canUseAdminCollections||null!=i&&!i.node.assigned&&!t.canUseAdminCollections)),(0,si.d)({refCount:!0,bufferSize:1}));n.pipe((0,m.w)((()=>(0,v.a)([this.route.queryParams,t]))),(0,m.w)((([e,i])=>Gt(this,void 0,void 0,(function*(){const t=nn(e);t&&(i.canUseAdminCollections||null!=(yield this.cipherService.get(t))?this.editCipherId(t):(this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("unknownCipher")),this.router.navigate([],{queryParams:{cipherId:null,itemId:null},queryParamsHandling:"merge"})))})))),(0,_.R)(this.destroy$)).subscribe(),n.pipe((0,m.w)((()=>(0,v.a)([this.route.queryParams,t,s]))),(0,m.w)((([e,i,t])=>Gt(this,void 0,void 0,(function*(){const n=e.viewEvents;if(!n)return;const o=t.find((e=>e.id===n));i.useEvents&&null!=o?this.viewEvents(o):(this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("unknownCipher")),this.router.navigate([],{queryParams:{viewEvents:null},queryParamsHandling:"merge"}))})))),(0,_.R)(this.destroy$)).subscribe(),n.pipe((0,m.w)((()=>this.refresh$)),(0,f.b)((()=>this.refreshing=!0)),(0,m.w)((()=>(0,v.a)([t,e,l,r,c,u,d,h]))),(0,_.R)(this.destroy$)).subscribe((([e,i,t,n,o,l,r,s])=>{this.organization=e,this.filter=i,this.allCollections=t,this.allGroups=n,this.ciphers=o,this.collections=l,this.selectedCollection=r,this.showMissingCollectionPermissionMessage=s,this.isEmpty=0===(null==l?void 0:l.length)&&0===(null==o?void 0:o.length),this.vaultFilterService.reloadCollections(t),this.refreshing=!1,this.performingInitialLoad=!1}))}))}get loading(){return this.refreshing||this.processingEvent}ngOnDestroy(){this.broadcasterService.unsubscribe(en),this.destroy$.next(),this.destroy$.complete()}onVaultItemsEvent(e){return Gt(this,void 0,void 0,(function*(){this.processingEvent=!0;try{if("viewAttachments"===e.type)yield this.editCipherAttachments(e.item);else if("viewCollections"===e.type)yield this.editCipherCollections(e.item);else if("clone"===e.type)yield this.cloneCipher(e.item);else if("restore"===e.type)1===e.items.length?yield this.restore(e.items[0]):yield this.bulkRestore(e.items);else if("delete"===e.type){const i=e.items.filter((e=>void 0===e.collection)).map((e=>e.cipher)),t=e.items.filter((e=>void 0===e.cipher)).map((e=>e.collection));1===i.length&&0===t.length?yield this.deleteCipher(i[0]):0===i.length&&1===t.length?yield this.deleteCollection(t[0]):yield this.bulkDelete(i,t,this.organization)}else"copyField"===e.type?yield this.copy(e.item,e.field):"editCollection"===e.type?yield this.editCollection(e.item,$e.sn.Info):"viewCollectionAccess"===e.type?yield this.editCollection(e.item,$e.sn.Access):"bulkEditCollectionAccess"===e.type?yield this.bulkEditCollectionAccess(e.items):"viewEvents"===e.type&&(yield this.viewEvents(e.item))}finally{this.processingEvent=!1}}))}filterSearchText(e){this.searchText$.next(e)}editCipherAttachments(e){return Gt(this,void 0,void 0,(function*(){if(0!==(null==e?void 0:e.reprompt)&&!(yield this.passwordRepromptService.showPasswordPrompt()))return void this.go({cipherId:null,itemId:null});if(null==this.organization.maxStorageGb||0===this.organization.maxStorageGb)return void this.messagingService.send("upgradeOrganization",{organizationId:e.organizationId});let i=!1;const[t]=yield this.modalService.openViewRef(Ei,this.attachmentsModalRef,(t=>{t.organization=this.organization,t.cipherId=e.id,t.onUploadedAttachment.pipe((0,_.R)(this.destroy$)).subscribe((()=>i=!0)),t.onDeletedAttachment.pipe((0,_.R)(this.destroy$)).subscribe((()=>i=!0))}));t.onClosed.pipe((0,_.R)(this.destroy$)).subscribe((()=>{i&&this.refresh(),i=!1}))}))}editCipherCollections(e){return Gt(this,void 0,void 0,(function*(){const i=yield(0,oi.z)(this.vaultFilterService.filteredCollections$),[t]=yield this.modalService.openViewRef(lt,this.collectionsModalRef,(n=>{n.collectionIds=e.collectionIds,n.collections=i.filter((e=>!e.readOnly&&e.id!=wi.JK)),n.organization=this.organization,n.cipherId=e.id,n.onSavedCollections.pipe((0,_.R)(this.destroy$)).subscribe((()=>{t.close(),this.refresh()}))}))}))}addCipher(){return Gt(this,void 0,void 0,(function*(){const e=(yield(0,oi.z)(this.vaultFilterService.filteredCollections$)).filter((e=>!e.readOnly&&e.id!=wi.JK));yield this.editCipher(null,(i=>{i.type=this.activeFilter.cipherType,i.collections=e,this.activeFilter.collectionId&&(i.collectionIds=[this.activeFilter.collectionId])}))}))}navigateToCipher(e){return Gt(this,void 0,void 0,(function*(){this.go({itemId:null==e?void 0:e.id})}))}editCipher(e,i){return Gt(this,void 0,void 0,(function*(){return this.editCipherId(null==e?void 0:e.id,i)}))}editCipherId(e,i){return Gt(this,void 0,void 0,(function*(){const t=yield this.cipherService.get(e);if(t&&0!==t.reprompt&&!(yield this.passwordRepromptService.showPasswordPrompt()))return void this.go({cipherId:null,itemId:null});const n=i=>{i.organization=this.organization,i.organizationId=this.organization.id,i.cipherId=e,i.onSavedCipher.pipe((0,_.R)(this.destroy$)).subscribe((()=>{o.close(),this.refresh()})),i.onDeletedCipher.pipe((0,_.R)(this.destroy$)).subscribe((()=>{o.close(),this.refresh()})),i.onRestoredCipher.pipe((0,_.R)(this.destroy$)).subscribe((()=>{o.close(),this.refresh()}))},[o,l]=yield this.modalService.openViewRef(yi.Z,this.cipherAddEditModalRef,null==i?n:e=>{n(e),i(e)});return o.onClosedPromise().then((()=>{this.go({cipherId:null,itemId:null})})),l}))}cloneCipher(e){var i;return Gt(this,void 0,void 0,(function*(){if(null===(i=e.login)||void 0===i?void 0:i.hasFido2Credentials){if(!(yield this.dialogService.openSimpleDialog({title:{key:"passkeyNotCopied"},content:{key:"passkeyNotCopiedAlert"},type:"info"})))return!1}const t=(yield(0,oi.z)(this.vaultFilterService.filteredCollections$)).filter((e=>!e.readOnly&&e.id!=wi.JK));yield this.editCipher(e,(i=>{i.cloneMode=!0,i.collections=t,i.collectionIds=e.collectionIds}))}))}restore(e){var i;return Gt(this,void 0,void 0,(function*(){if((yield this.repromptCipher([e]))&&e.isDeleted)try{const t=null===(i=this.organization)||void 0===i?void 0:i.canEditAnyCollection;yield this.cipherService.restoreWithServer(e.id,t),this.platformUtilsService.showToast("success",null,this.i18nService.t("restoredItem")),this.refresh()}catch(t){this.logService.error(t)}}))}bulkRestore(e){return Gt(this,void 0,void 0,(function*(){if(!(yield this.repromptCipher(e)))return;const i=e.map((e=>e.id));0!==i.length?(yield this.cipherService.restoreManyWithServer(i),this.platformUtilsService.showToast("success",null,this.i18nService.t("restoredItems")),this.refresh()):this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("nothingSelected"))}))}deleteCipher(e){return Gt(this,void 0,void 0,(function*(){if(!(yield this.repromptCipher([e])))return;const i=e.isDeleted;if(!(yield this.dialogService.openSimpleDialog({title:{key:i?"permanentlyDeleteItem":"deleteItem"},content:{key:i?"permanentlyDeleteItemConfirmation":"deleteItemConfirmation"},type:"warning"})))return!1;try{yield this.deleteCipherWithServer(e.id,i),this.platformUtilsService.showToast("success",null,this.i18nService.t(i?"permanentlyDeletedItem":"deletedItem")),this.refresh()}catch(t){this.logService.error(t)}}))}deleteCollection(e){var i,t,n,o;return Gt(this,void 0,void 0,(function*(){if(!this.organization.canDeleteAssignedCollections&&!this.organization.canDeleteAnyCollection)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("missingPermissions"));if(yield this.dialogService.openSimpleDialog({title:e.name,content:{key:"deleteCollectionConfirmation"},type:"warning"}))try{yield this.apiService.deleteCollection(null===(i=this.organization)||void 0===i?void 0:i.id,e.id),this.platformUtilsService.showToast("success",null,this.i18nService.t("deletedCollectionId",e.name)),(null===(t=this.selectedCollection)||void 0===t?void 0:t.node.id)===e.id&&this.router.navigate([],{queryParams:{collectionId:null!==(o=null===(n=this.selectedCollection.parent)||void 0===n?void 0:n.node.id)&&void 0!==o?o:null},queryParamsHandling:"merge",replaceUrl:!0}),this.refresh()}catch(l){this.logService.error(l)}}))}bulkDelete(e,i,t){return Gt(this,void 0,void 0,(function*(){if(!(yield this.repromptCipher(e)))return;if(0===e.length&&0===i.length)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("nothingSelected"));const n=(0,bi.E)(this.dialogService,{data:{permanent:"trash"===this.filter.type,cipherIds:e.map((e=>e.id)),collectionIds:i.map((e=>e.id)),organization:t}});(yield(0,w.n)(n.closed))===bi.Jg.Deleted&&this.refresh()}))}copy(e,i){return Gt(this,void 0,void 0,(function*(){let t,n,o;if("username"===i)t="Username",n=e.login.username,o="username";else if("password"===i)t="Password",n=e.login.password,o="password";else{if("totp"!==i)return void this.platformUtilsService.showToast("info",null,this.i18nService.t("unexpectedError"));t="TOTP",n=yield this.totpService.getCode(e.login.totp),o="verificationCodeTotp"}this.passwordRepromptService.protectedFields().includes(t)&&!(yield this.repromptCipher([e]))||e.viewPassword&&(this.platformUtilsService.copyToClipboard(n,{window}),this.platformUtilsService.showToast("info",null,this.i18nService.t("valueCopied",this.i18nService.t(o))),"password"===i?this.eventCollectionService.collect(ui.tw.Cipher_ClientCopiedPassword,e.id):"totp"===i&&this.eventCollectionService.collect(ui.tw.Cipher_ClientCopiedHiddenField,e.id))}))}addCollection(){var e,i;return Gt(this,void 0,void 0,(function*(){const t=(0,$e.ku)(this.dialogService,{data:{organizationId:null===(e=this.organization)||void 0===e?void 0:e.id,parentCollectionId:null===(i=this.selectedCollection)||void 0===i?void 0:i.node.id}}),n=yield(0,w.n)(t.closed);n.action!==$e.a8.Saved&&n.action!==$e.a8.Deleted||this.refresh()}))}editCollection(e,i){var t;return Gt(this,void 0,void 0,(function*(){const n=(0,$e.ku)(this.dialogService,{data:{collectionId:null==e?void 0:e.id,organizationId:null===(t=this.organization)||void 0===t?void 0:t.id,initialTab:i}}),o=yield(0,w.n)(n.closed);o.action!==$e.a8.Saved&&o.action!==$e.a8.Deleted||this.refresh()}))}bulkEditCollectionAccess(e){var i;return Gt(this,void 0,void 0,(function*(){if(0===e.length)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("nothingSelected"));const t=ji.open(this.dialogService,{data:{collections:e,organizationId:null===(i=this.organization)||void 0===i?void 0:i.id}});(yield(0,w.n)(t.closed))===Qi.Saved&&this.refresh()}))}viewEvents(e){return Gt(this,void 0,void 0,(function*(){yield(0,fi.Z)(this.dialogService,{data:{name:e.name,organizationId:this.organization.id,entityId:e.id,showUser:!0,entity:"cipher"}})}))}deleteCipherWithServer(e,i){var t;const n=null===(t=this.organization)||void 0===t?void 0:t.canEditAnyCollection;return i?this.cipherService.deleteWithServer(e,n):this.cipherService.softDeleteWithServer(e,n)}repromptCipher(e){return Gt(this,void 0,void 0,(function*(){const i=!e.find((e=>e.reprompt!==hi.N.None));return i||(yield this.passwordRepromptService.showPasswordPrompt())}))}refresh(){this.refresh$.next()}go(e=null){null==e&&(e={type:this.activeFilter.cipherType,collectionId:this.activeFilter.collectionId,deleted:this.activeFilter.isDeleted||null}),this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:"merge",replaceUrl:!0})}}tn.ɵfac=function(e){return new(e||tn)(h.Y36(r.gz),h.Y36(c.Mn),h.Y36(Re.n),h.Y36(Ui.b),h.Y36(Zi.q),h.Y36(r.F0),h.Y36(h.sBO),h.Y36(pt._),h.Y36(O.D),h.Y36(ai.Z),h.Y36(D.x),h.Y36(gt.o),h.Y36(ft.A),h.Y36(h.R0b),h.Y36(G.P),h.Y36(Xe.u),h.Y36(gi.C),h.Y36(Ke.m),h.Y36(pe.o),h.Y36(y.C),h.Y36(l.lT),h.Y36(N.$),h.Y36(mt.j),h.Y36(vt.w),h.Y36(F.s),h.Y36($.i))},tn.ɵcmp=h.Xpm({type:tn,selectors:[["app-org-vault"]],viewQuery:function(e,i){if(1&e&&(h.Gf(Nt,7),h.Gf(Dt,7,h.s_b),h.Gf($t,7,h.s_b),h.Gf(Et,7,h.s_b)),2&e){let e;h.iGM(e=h.CRH())&&(i.vaultFilterComponent=e.first),h.iGM(e=h.CRH())&&(i.attachmentsModalRef=e.first),h.iGM(e=h.CRH())&&(i.cipherAddEditModalRef=e.first),h.iGM(e=h.CRH())&&(i.collectionsModalRef=e.first)}},features:[h._Bn([Zi.q,Ui.b])],decls:48,vars:34,consts:[[1,"container","page-content"],[1,"row"],[1,"col-3"],[1,"groupings"],[1,"content"],[1,"inner-content"],[3,"organization","activeFilter","searchText","searchTextChanged"],["vaultFilter",""],[1,"col-9"],[3,"filter","loading","organization","collection","onAddCipher","onAddCollection","onEditCollection","onDeleteCollection"],["type","warning","icon","bwi bwi-exclamation-triangle",4,"ngIf"],[3,"ciphers","collections","allCollections","allOrganizations","allGroups","disabled","showOwner","showCollections","showGroups","showPremiumFeatures","showBulkMove","showBulkTrashOptions","useEvents","cloneableOrganizationCiphers","showAdminActions","showBulkEditCollectionAccess","onEvent"],["class","tw-mt-6 tw-flex tw-h-full tw-flex-col tw-items-center tw-justify-start",4,"ngIf"],["attachments",""],["cipherAddEdit",""],["collectionsModal",""],["type","warning","icon","bwi bwi-exclamation-triangle"],[1,"tw-mt-6","tw-flex","tw-h-full","tw-flex-col","tw-items-center","tw-justify-start"],["aria-hidden","true",3,"icon"],["type","button","buttonType","primary","bitButton","",3,"click",4,"ngIf"],["type","button","buttonType","primary","bitButton","",3,"click"],["aria-hidden","true",1,"bwi","bwi-plus","bwi-fw"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","text-muted",3,"title"],[1,"sr-only"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div",1),h._uU(3,"\n    "),h.TgZ(4,"div",2),h._uU(5,"\n      "),h.TgZ(6,"div",3),h._uU(7,"\n        "),h.TgZ(8,"div",4),h._uU(9,"\n          "),h.TgZ(10,"div",5),h._uU(11,"\n            "),h.TgZ(12,"app-organization-vault-filter",6,7),h.NdJ("searchTextChanged",(function(e){return i.filterSearchText(e)})),h.ALo(14,"async"),h.qZA(),h._uU(15,"\n          "),h.qZA(),h._uU(16,"\n        "),h.qZA(),h._uU(17,"\n      "),h.qZA(),h._uU(18,"\n    "),h.qZA(),h._uU(19,"\n    "),h.TgZ(20,"div",8),h._uU(21,"\n      "),h.TgZ(22,"app-org-vault-header",9),h.NdJ("onAddCipher",(function(){return i.addCipher()}))("onAddCollection",(function(){return i.addCollection()}))("onEditCollection",(function(e){return i.editCollection(i.selectedCollection.node,e.tab)}))("onDeleteCollection",(function(){return i.deleteCollection(i.selectedCollection.node)})),h.qZA(),h._uU(23,"\n      "),h.YNc(24,Qt,2,1,"app-callout",10),h._uU(25,"\n      "),h.TgZ(26,"app-vault-items",11),h.NdJ("onEvent",(function(e){return i.onVaultItemsEvent(e)})),h.ALo(27,"async"),h._uU(28,"\n      "),h.qZA(),h._uU(29,"\n      "),h.YNc(30,Pt,8,4,"div",12),h._uU(31,"\n      "),h.YNc(32,Bt,10,5,"div",12),h._uU(33,"\n      "),h.YNc(34,Ht,9,6,"div",12),h._uU(35,"\n    "),h.qZA(),h._uU(36,"\n  "),h.qZA(),h._uU(37,"\n  "),h.YNc(38,jt,0,0,"ng-template",null,13,h.W1O),h._uU(40,"\n  "),h.YNc(41,Kt,0,0,"ng-template",null,14,h.W1O),h._uU(43,"\n  "),h.YNc(44,Wt,0,0,"ng-template",null,15,h.W1O),h._uU(46,"\n"),h.qZA(),h._uU(47,"\n")),2&e&&(h.xp6(12),h.Q6J("organization",i.organization)("activeFilter",i.activeFilter)("searchText",h.lcZ(14,27,i.currentSearchText$)),h.xp6(10),h.Q6J("filter",i.filter)("loading",i.refreshing)("organization",i.organization)("collection",i.selectedCollection),h.xp6(2),h.Q6J("ngIf",i.activeFilter.isDeleted),h.xp6(2),h.Q6J("ciphers",i.ciphers)("collections",i.collections)("allCollections",i.allCollections)("allOrganizations",i.organization?h.VKq(31,Vt,i.organization):h.DdM(33,Xt))("allGroups",i.allGroups)("disabled",i.loading)("showOwner",!1)("showCollections",void 0!==i.filter.type)("showGroups",(null==i.organization?null:i.organization.useGroups)&&(void 0===i.filter.type&&void 0===i.filter.collectionId||void 0!==i.filter.collectionId))("showPremiumFeatures",null==i.organization?null:i.organization.useTotp)("showBulkMove",!1)("showBulkTrashOptions","trash"===i.filter.type)("useEvents",null==i.organization?null:i.organization.useEvents)("cloneableOrganizationCiphers",!0)("showAdminActions",!0)("showBulkEditCollectionAccess",h.lcZ(27,29,i.showBulkEditCollectionAccess$)),h.xp6(4),h.Q6J("ngIf",i.showMissingCollectionPermissionMessage),h.xp6(2),h.Q6J("ngIf",i.isEmpty&&!i.showMissingCollectionPermissionMessage&&!i.performingInitialLoad),h.xp6(2),h.Q6J("ngIf",i.performingInitialLoad))},dependencies:[ht,E.O5,bt.O,j.r,Ut.G,Zt.JS,kt,E.Ov,re.C],encapsulation:2});const nn=e=>e.itemId||e.cipherId,on=[{path:"",component:tn,canActivate:[a.G],data:{titleId:"vaults",organizationPermissions:c.Po}}];class ln{}ln.ɵfac=function(e){return new(e||ln)},ln.ɵmod=h.oAB({type:ln}),ln.ɵinj=h.cJS({imports:[r.Bz.forChild(on),r.Bz]});class rn{}rn.ɵfac=function(e){return new(e||rn)},rn.ɵmod=h.oAB({type:rn}),rn.ɵinj=h.cJS({imports:[ln,ni,Ge.m,ke.f,Pe.x,Qe.e,Ne.D,De.D,Oe.J,Ee.z,$e.WK]});const sn=[{path:":organizationId",component:d.f,canActivate:[s.a1,a.G],data:{organizationPermissions:c.gW},children:[{path:"",pathMatch:"full",canActivate:[u.S],data:{autoRedirectCallback:function(e){if((0,c.Po)(e))return"vault";if((0,c.tt)(e))return"members";if((0,c.WW)(e))return"groups";if((0,c.$G)(e))return"reporting";if((0,c.DL)(e))return"settings";return}},children:[]},{path:"vault",loadChildren:()=>rn},{path:"settings",loadChildren:()=>t.e(554).then(t.bind(t,86554)).then((e=>e.OrganizationSettingsModule))},{path:"members",loadChildren:()=>t.e(16).then(t.bind(t,38016)).then((e=>e.MembersModule))},{path:"groups",component:Ye,canActivate:[a.G],data:{titleId:"groups",organizationPermissions:c.WW}},{path:"reporting",loadChildren:()=>t.e(466).then(t.bind(t,41466)).then((e=>e.OrganizationReportingModule))},{path:"billing",loadChildren:()=>Promise.all([t.e(883),t.e(509)]).then(t.bind(t,75509)).then((e=>e.OrganizationBillingModule))}]}];class cn{}cn.ɵfac=function(e){return new(e||cn)},cn.ɵmod=h.oAB({type:cn}),cn.ɵinj=h.cJS({imports:[r.Bz.forChild(sn),r.Bz]});var an=t(64984);class un{}un.ɵfac=function(e){return new(e||un)},un.ɵmod=h.oAB({type:un}),un.ɵinj=h.cJS({imports:[an.P,L.k4,l.WO,cn]})},14309:(e,i,t)=>{t.d(i,{E2:()=>l.E2,R9:()=>n.R,XL:()=>l.XL,d4:()=>l.d4,hs:()=>l.hs,k4:()=>o.k,zD:()=>l.zD});var n=t(30674),o=t(1176),l=t(34632)},64984:(e,i,t)=>{t.d(i,{P:()=>s});var n=t(27420),o=t(85921),l=t(1176),r=t(24852);class s{}s.ɵfac=function(e){return new(e||s)},s.ɵmod=r.oAB({type:s}),s.ɵinj=r.cJS({imports:[o.m,l.k,n.t,o.m,l.k,n.t]})}}]);
//# sourceMappingURL=589.313cd6efc02e55d19588.js.map