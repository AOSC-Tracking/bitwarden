"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[987],{65987:(t,e,i)=>{i.d(e,{Y:()=>z});var n=i(99042),o=i(24852),r=i(98645),s=i(54019),c=i(68362),l=i(62324),a=i(53634),p=i(28055),u=i(82083),d=i(85958),f=i(76528),h=i(78627),g=i(99721),y=i(87483),m=i(83924),x=i(66459),v=i(42304),w=i(53481),_=i(73369),U=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(e){r(e)}}function c(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}l((n=n.apply(t,e||[])).next())}))};class Z{get disabledByPolicy(){return this._disabledByPolicy}constructor(t,e,i,n,c,l,a,p,d,f,h,g){this.cryptoService=t,this.i18nService=e,this.platformUtilsService=i,this.exportService=n,this.eventCollectionService=c,this.policyService=l,this.win=a,this.logService=p,this.userVerificationService=d,this.formBuilder=f,this.fileDownloadService=h,this.dialogService=g,this.onSaved=new o.vpe,this._disabledByPolicy=!1,this.exportForm=this.formBuilder.group({format:["json"],secret:[""],filePassword:["",r.kI.required],confirmFilePassword:["",r.kI.required],fileEncryptionType:[u.x$.AccountEncrypted]}),this.formatOptions=[{name:".json",value:"json"},{name:".csv",value:"csv"},{name:".json (Encrypted)",value:"encrypted_json"}],this.destroy$=new s.x}ngOnInit(){return U(this,void 0,void 0,(function*(){this.policyService.policyAppliesToActiveUser$(p.Mi.DisablePersonalVaultExport).pipe((0,c.R)(this.destroy$)).subscribe((t=>{this._disabledByPolicy=t,this.disabledByPolicy&&this.exportForm.disable()})),(0,l.T)(this.exportForm.get("format").valueChanges,this.exportForm.get("fileEncryptionType").valueChanges).pipe((0,c.R)(this.destroy$)).pipe((0,a.O)(0)).subscribe((()=>this.adjustValidators()))}))}ngOnDestroy(){this.destroy$.next()}get encryptedFormat(){return"encrypted_json"===this.format}doExport(){return U(this,void 0,void 0,(function*(){try{this.formPromise=this.getExportData();const t=yield this.formPromise;this.downloadFile(t),this.saved(),yield this.collectEvent(),this.exportForm.get("secret").setValue(""),this.exportForm.clearValidators()}catch(t){this.logService.error(t)}}))}submit(){return U(this,void 0,void 0,(function*(){if(this.disabledByPolicy)return void this.platformUtilsService.showToast("error",null,this.i18nService.t("personalVaultExportPolicyInEffect"));if(!(yield this.warningDialog()))return;const t=this.exportForm.get("secret").value;try{yield this.userVerificationService.verifyUser(t)}catch(e){return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),e.message)}this.doExport()}))}warningDialog(){return U(this,void 0,void 0,(function*(){return this.encryptedFormat?yield this.dialogService.openSimpleDialog({title:{key:"confirmVaultExport"},content:this.i18nService.t("encExportKeyWarningDesc")+" "+this.i18nService.t("encExportAccountWarningDesc"),acceptButtonText:{key:"exportVault"},type:"warning"}):yield this.dialogService.openSimpleDialog({title:{key:"confirmVaultExport"},content:{key:"exportWarningDesc"},acceptButtonText:{key:"exportVault"},type:"warning"})}))}saved(){this.onSaved.emit()}getExportData(){return"encrypted_json"===this.format&&this.fileEncryptionType===u.x$.FileEncrypted?this.exportService.getPasswordProtectedExport(this.filePassword):this.exportService.getExport(this.format,null)}getFileName(t){let e=this.format;return"encrypted_json"===this.format&&(t=null==t?"encrypted":"encrypted_"+t,e="json"),this.exportService.getFileName(t,e)}collectEvent(){return U(this,void 0,void 0,(function*(){yield this.eventCollectionService.collect(u.tw.User_ClientExportedVault)}))}get format(){return this.exportForm.get("format").value}get filePassword(){return this.exportForm.get("filePassword").value}get confirmFilePassword(){return this.exportForm.get("confirmFilePassword").value}get fileEncryptionType(){return this.exportForm.get("fileEncryptionType").value}adjustValidators(){this.exportForm.get("confirmFilePassword").reset(),this.exportForm.get("filePassword").reset(),this.encryptedFormat&&this.fileEncryptionType==u.x$.FileEncrypted?(this.exportForm.controls.filePassword.enable(),this.exportForm.controls.confirmFilePassword.enable()):(this.exportForm.controls.filePassword.disable(),this.exportForm.controls.confirmFilePassword.disable())}downloadFile(t){const e=this.getFileName();this.fileDownloadService.download({fileName:e,blobData:t,blobOptions:{type:"text/plain"}})}}Z.ɵfac=function(t){return new(t||Z)(o.Y36(f.$),o.Y36(h.D),o.Y36(g.P),o.Y36(d.qX),o.Y36(y.j),o.Y36(m.d),o.Y36(Window),o.Y36(x.$),o.Y36(v.i),o.Y36(r.QS),o.Y36(w._),o.Y36(_.x))},Z.ɵdir=o.lG2({type:Z,outputs:{onSaved:"onSaved"}});var E=i(4519),b=i(19419),T=i(24610),A=i(25376),F=i(53707),P=i(90258),S=i(24637),q=i(11512),I=i(54666),Y=i(1e4),C=i(36179),O=i(44358),D=i(21656),k=i(82933),L=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(e){r(e)}}function c(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}l((n=n.apply(t,e||[])).next())}))};function N(t,e){1&t&&(o.TgZ(0,"app-callout",15),o.ALo(1,"i18n"),o._uU(2),o.ALo(3,"i18n"),o.qZA()),2&t&&(o.s9C("title",o.lcZ(1,2,"vaultExportDisabled")),o.xp6(2),o.hij("\n    ",o.lcZ(3,4,"personalVaultExportPolicyInEffect"),"\n  "))}function j(t,e){if(1&t&&o._UZ(0,"app-export-scope-callout",16),2&t){const t=o.oxw(2);o.Q6J("organizationId",t.organizationId)}}function B(t,e){if(1&t&&(o.TgZ(0,"option",17),o._uU(1),o.qZA()),2&t){const t=e.$implicit;o.Q6J("value",t.value),o.xp6(1),o.Oqu(t.name)}}function V(t,e){if(1&t){const t=o.EpF();o.ynx(0),o._uU(1,"\n          "),o.TgZ(2,"bit-form-field"),o._uU(3,"\n            "),o.TgZ(4,"bit-label"),o._uU(5),o.ALo(6,"i18n"),o.qZA(),o._uU(7,"\n            "),o._UZ(8,"input",28),o._uU(9,"\n            "),o.TgZ(10,"button",29),o.NdJ("toggledChange",(function(e){o.CHM(t);const i=o.oxw(3);return o.KtG(i.showFilePassword=e)})),o.qZA(),o._uU(11,"\n            "),o.TgZ(12,"bit-hint"),o._uU(13),o.ALo(14,"i18n"),o.qZA(),o._uU(15,"\n          "),o.qZA(),o._uU(16,"\n          "),o.TgZ(17,"bit-form-field"),o._uU(18,"\n            "),o.TgZ(19,"bit-label"),o._uU(20),o.ALo(21,"i18n"),o.qZA(),o._uU(22,"\n            "),o._UZ(23,"input",30),o._uU(24,"\n            "),o.TgZ(25,"button",29),o.NdJ("toggledChange",(function(e){o.CHM(t);const i=o.oxw(3);return o.KtG(i.showFilePassword=e)})),o.qZA(),o._uU(26,"\n          "),o.qZA(),o._uU(27,"\n        "),o.BQk()}if(2&t){const t=o.oxw(3);o.xp6(5),o.Oqu(o.lcZ(6,5,"filePassword")),o.xp6(5),o.Q6J("toggled",t.showFilePassword),o.xp6(3),o.Oqu(o.lcZ(14,7,"exportPasswordDescription")),o.xp6(7),o.Oqu(o.lcZ(21,9,"confirmFilePassword")),o.xp6(5),o.Q6J("toggled",t.showFilePassword)}}function J(t,e){if(1&t&&(o.ynx(0),o._uU(1,"\n        "),o.TgZ(2,"div",18),o._uU(3,"\n          "),o.TgZ(4,"label",19),o._uU(5),o.ALo(6,"i18n"),o.qZA(),o._uU(7,"\n\n          "),o.TgZ(8,"div",20),o._uU(9,"\n            "),o.TgZ(10,"div"),o._uU(11,"\n              "),o._UZ(12,"input",21),o._uU(13,"\n            "),o.qZA(),o._uU(14,"\n            "),o.TgZ(15,"div"),o._uU(16,"\n              "),o.TgZ(17,"label",22),o._uU(18),o.ALo(19,"i18n"),o.qZA(),o._uU(20,"\n            "),o.qZA(),o._uU(21,"\n          "),o.qZA(),o._uU(22,"\n\n          "),o.TgZ(23,"div",23),o._uU(24),o.ALo(25,"i18n"),o.qZA(),o._uU(26,"\n\n          "),o.TgZ(27,"div",24),o._uU(28,"\n            "),o.TgZ(29,"div"),o._uU(30,"\n              "),o._UZ(31,"input",25),o._uU(32,"\n            "),o.qZA(),o._uU(33,"\n            "),o.TgZ(34,"div"),o._uU(35,"\n              "),o.TgZ(36,"label",26),o._uU(37),o.ALo(38,"i18n"),o.qZA(),o._uU(39,"\n            "),o.qZA(),o._uU(40,"\n          "),o.qZA(),o._uU(41,"\n\n          "),o.TgZ(42,"div",27),o._uU(43),o.ALo(44,"i18n"),o.qZA(),o._uU(45,"\n        "),o.qZA(),o._uU(46,"\n        "),o._UZ(47,"br"),o._uU(48,"\n\n        "),o.YNc(49,V,28,11,"ng-container",12),o._uU(50,"\n      "),o.BQk()),2&t){const t=o.oxw(2);o.xp6(5),o.hij("\n            ",o.lcZ(6,10,"exportTypeHeading"),"\n          "),o.xp6(7),o.Q6J("value",t.encryptedExportType.AccountEncrypted)("checked",t.fileEncryptionType===t.encryptedExportType.AccountEncrypted),o.xp6(6),o.hij("\n                ",o.lcZ(19,12,"accountRestricted"),"\n              "),o.xp6(6),o.hij("\n            ",o.lcZ(25,14,"accountRestrictedOptionDescription"),"\n          "),o.xp6(7),o.Q6J("value",t.encryptedExportType.FileEncrypted)("checked",t.fileEncryptionType===t.encryptedExportType.FileEncrypted),o.xp6(6),o.Oqu(o.lcZ(38,16,"passwordProtected")),o.xp6(6),o.hij("\n            ",o.lcZ(44,18,"passwordProtectedOptionDescription"),"\n          "),o.xp6(6),o.Q6J("ngIf",t.fileEncryptionType==t.encryptedExportType.FileEncrypted)}}const Q=function(t){return{manual:t}};function $(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"form",1,2),o.NdJ("ngSubmit",(function(){o.CHM(t);const e=o.oxw();return o.KtG(e.submit())})),o._uU(2,"\n  "),o.TgZ(3,"div",3),o._uU(4,"\n    "),o.TgZ(5,"h1"),o._uU(6),o.ALo(7,"i18n"),o.qZA(),o._uU(8,"\n  "),o.qZA(),o._uU(9,"\n\n  "),o.YNc(10,N,4,6,"app-callout",4),o._uU(11,"\n  "),o.YNc(12,j,1,1,"app-export-scope-callout",5),o._uU(13,"\n\n  "),o.TgZ(14,"div",6),o._uU(15,"\n    "),o.TgZ(16,"div",7),o._uU(17,"\n      "),o.TgZ(18,"bit-form-field"),o._uU(19,"\n        "),o.TgZ(20,"bit-label",8),o._uU(21),o.ALo(22,"i18n"),o.qZA(),o._uU(23,"\n        "),o.TgZ(24,"select",9),o._uU(25,"\n          "),o.YNc(26,B,2,2,"option",10),o._uU(27,"\n        "),o.qZA(),o._uU(28,"\n      "),o.qZA(),o._uU(29,"\n    "),o.qZA(),o._uU(30,"\n  "),o.qZA(),o._uU(31,"\n  "),o.TgZ(32,"div",6),o._uU(33,"\n    "),o.TgZ(34,"div",11),o._uU(35,"\n      "),o.YNc(36,J,51,20,"ng-container",12),o._uU(37,"\n\n      "),o.TgZ(38,"button",13),o._uU(39,"\n        "),o._UZ(40,"i",14),o.ALo(41,"i18n"),o._uU(42,"\n        "),o.TgZ(43,"span"),o._uU(44),o.ALo(45,"i18n"),o.qZA(),o._uU(46,"\n      "),o.qZA(),o._uU(47,"\n    "),o.qZA(),o._uU(48,"\n  "),o.qZA(),o._uU(49,"\n"),o.qZA()}if(2&t){const t=o.MAs(1),e=o.oxw();o.Q6J("appApiAction",e.formPromise)("formGroup",e.exportForm),o.xp6(6),o.Oqu(o.lcZ(7,12,"exportVault")),o.xp6(4),o.Q6J("ngIf",e.disabledByPolicy),o.xp6(2),o.Q6J("ngIf",!e.disabledByPolicy),o.xp6(9),o.Oqu(o.lcZ(22,14,"fileFormat")),o.xp6(5),o.Q6J("ngForOf",e.formatOptions),o.xp6(10),o.Q6J("ngIf","encrypted_json"===e.format),o.xp6(2),o.Q6J("disabled",t.loading||e.disabledByPolicy)("ngClass",o.VKq(20,Q,e.disabledByPolicy)),o.xp6(2),o.s9C("title",o.lcZ(41,16,"loading")),o.xp6(4),o.Oqu(o.lcZ(45,18,"confirmFormat"))}}class z extends Z{constructor(t,e,i,n,o,r,s,c,l,a,p){super(t,e,i,n,o,r,window,s,c,l,a,p),this.encryptedExportType=u.x$}submit(){return L(this,void 0,void 0,(function*(){if(this.isFileEncryptedExport&&this.filePassword!=this.confirmFilePassword)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("filePasswordAndConfirmFilePasswordDoNotMatch"));if(this.exportForm.markAllAsTouched(),!this.exportForm.valid)return;if(this.disabledByPolicy)return void this.platformUtilsService.showToast("error",null,this.i18nService.t("personalVaultExportPolicyInEffect"));(yield this.verifyUser())&&this.doExport()}))}saved(){super.saved(),this.platformUtilsService.showToast("success",null,this.i18nService.t("exportSuccess"))}verifyUser(){let t="exportWarningDesc";this.isFileEncryptedExport?t="fileEncryptedExportWarningDesc":this.isAccountEncryptedExport&&(t="encExportKeyWarningDesc");const e=(0,E.CV)(this.dialogService,{data:{confirmDescription:t,confirmButtonText:"exportVault",modalTitle:"confirmVaultExport"}});if(null!=e)return(0,n.z)(e.closed)}get isFileEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===u.x$.FileEncrypted}get isAccountEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===u.x$.AccountEncrypted}}z.ɵfac=function(t){return new(t||z)(o.Y36(f.$),o.Y36(h.D),o.Y36(g.P),o.Y36(d.qX),o.Y36(y.j),o.Y36(m.d),o.Y36(x.$),o.Y36(v.i),o.Y36(r.QS),o.Y36(w._),o.Y36(_.x))},z.ɵcmp=o.Xpm({type:z,selectors:[["app-export"]],features:[o.qOj],decls:4,vars:1,consts:[[3,"appApiAction","formGroup","ngSubmit",4,"ngIf"],[3,"appApiAction","formGroup","ngSubmit"],["form",""],[1,"page-header"],["type","error",3,"title",4,"ngIf"],[3,"organizationId",4,"ngIf"],[1,"row"],[1,"col-6"],["for","format",1,"tw-text-lg"],["bitInput","","name","format","formControlName","format"],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","col-6"],[4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-submit",3,"disabled","ngClass"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin",3,"title"],["type","error",3,"title"],[3,"organizationId"],[3,"value"],["role","radiogroup","aria-labelledby","exportTypeHeading"],["id","exportTypeHeading",1,"tw-semi-bold","tw-text-lg"],["appBoxRow","","name","FileTypeOptions",1,"tw-flex","tw-items-center"],["type","radio","name","fileEncryptionType","id","AccountEncrypted","formControlName","fileEncryptionType",1,"radio",3,"value","checked"],["for","AccountEncrypted",1,"tw-semi-bold","tw-text-md","tw-my-1","tw-ml-1"],[1,"tw-regular","ml-3","pb-2","tw-text-sm"],[1,"tw-flex","tw-items-center"],["type","radio","name","fileEncryptionType","id","FileEncrypted","formControlName","fileEncryptionType",1,"radio",3,"value","checked"],["for","FileEncrypted",1,"tw-semi-bold","tw-text-md","tw-my-1","tw-ml-1"],[1,"tw-regular","ml-3","tw-text-sm"],["bitInput","","type","password","id","filePassword","formControlName","filePassword","name","password"],["type","button","bitSuffix","","bitIconButton","","bitPasswordInputToggle","",3,"toggled","toggledChange"],["bitInput","","type","password","id","confirmFilePassword","formControlName","confirmFilePassword","name","confirmFilePassword"]],template:function(t,e){1&t&&(o._uU(0,"\n"),o._uU(1,"\n"),o.YNc(2,$,50,22,"form",0),o._uU(3,"\n")),2&t&&(o.xp6(2),o.Q6J("ngIf",e.exportForm))},dependencies:[b.mk,b.sg,b.O5,r._Y,r.YN,r.Kr,r.Fj,r.EJ,r._,r.JJ,r.JL,r.sg,r.u,T.b,A.$,F.O,P.N,S.d,q.G,I.w,Y.e,C.u,O.M,D.Q,k.C],encapsulation:2})},25376:(t,e,i)=>{i.d(e,{$:()=>o});var n=i(24852);class o{constructor(t){this.el=null,this.el=t.nativeElement}ngOnInit(){this.formEls=Array.from(this.el.querySelectorAll('input:not([type="hidden"]), select, textarea')),this.formEls.forEach((t=>{t.addEventListener("focus",(()=>{this.el.classList.add("active")}),!1),t.addEventListener("blur",(()=>{this.el.classList.remove("active")}),!1)}))}onClick(t){const e=t.target;if((e===this.el||e.classList.contains("progress")||e.classList.contains("progress-bar"))&&this.formEls.length>0){const t=this.formEls[0];if("input"===t.tagName.toLowerCase()){const e=t;if(null!=e.type&&"checkbox"===e.type.toLowerCase())return void e.click()}t.focus()}}}o.ɵfac=function(t){return new(t||o)(n.Y36(n.SBq))},o.ɵdir=n.lG2({type:o,selectors:[["","appBoxRow",""]],hostBindings:function(t,e){1&t&&n.NdJ("click",(function(t){return e.onClick(t)}))}})},90258:(t,e,i)=>{i.d(e,{N:()=>u});var n=i(58691),o=i(24852),r=i(58172),s=i(19419),c=i(53707),l=i(82933),a=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{l(n.next(t))}catch(e){r(e)}}function c(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}l((n=n.apply(t,e||[])).next())}))};function p(t,e){if(1&t&&(o.ynx(0),o._uU(1,"\n  "),o.TgZ(2,"app-callout",1),o.ALo(3,"i18n"),o._uU(4),o.ALo(5,"i18n"),o.qZA(),o._uU(6,"\n"),o.BQk()),2&t){const t=o.oxw();o.xp6(2),o.s9C("title",o.lcZ(3,2,t.scopeConfig.title)),o.xp6(2),o.hij("\n    ",o.xi3(5,4,t.scopeConfig.description,t.scopeConfig.scopeIdentifier),"\n  ")}}class u{constructor(t,e){this.organizationService=t,this.stateService=e,this.organizationId=null,this.show=!1}ngOnInit(){return a(this,void 0,void 0,(function*(){this.organizationService.hasOrganizations()&&(this.scopeConfig=null!=this.organizationId?{title:"exportingOrganizationVaultTitle",description:"exportingOrganizationVaultDesc",scopeIdentifier:this.organizationService.get(this.organizationId).name}:{title:"exportingPersonalVaultTitle",description:"exportingIndividualVaultDescription",scopeIdentifier:yield this.stateService.getEmail()},this.show=!0)}))}}u.ɵfac=function(t){return new(t||u)(o.Y36(n.Mn),o.Y36(r.b))},u.ɵcmp=o.Xpm({type:u,selectors:[["app-export-scope-callout"]],inputs:{organizationId:"organizationId"},decls:2,vars:1,consts:[[4,"ngIf"],["type","info",3,"title"]],template:function(t,e){1&t&&(o.YNc(0,p,7,7,"ng-container",0),o._uU(1,"\n")),2&t&&o.Q6J("ngIf",e.show)},dependencies:[s.O5,c.O,l.C],encapsulation:2})}}]);
//# sourceMappingURL=987.4c42c3bee7e6acaa8fa2.js.map